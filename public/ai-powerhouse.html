<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Automation Powerhouse 2.0 | Enterprise Automation Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* ========================================
           PROFESSIONAL SAAS DESIGN SYSTEM
           ======================================== */
        :root {
            --primary: #d4af37;
            --primary-light: #f5e7b2;
            --primary-dark: #b8962e;
            --primary-gradient: linear-gradient(135deg, #d4af37 0%, #f1c40f 100%);
            
            --dark: #0f172a;
            --dark-accent: #1e293b;
            --light: #ffffff;
            --light-gray: #f8fafc;
            --medium-gray: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            
            --success: #059669;
            --success-light: #d1fae5;
            --danger: #dc2626;
            --danger-light: #fee2e2;
            --warning: #d97706;
            --warning-light: #fef3c7;
            --info: #2563eb;
            --info-light: #dbeafe;
            
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            
            --card-radius: 16px;
            --button-radius: 8px;
            --transition: all 0.2s ease;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f1f5f9;
            color: var(--text-primary); 
            line-height: 1.5; 
            overflow-x: hidden;
        }

        /* ===== ACCESS DENIED OVERLAY ===== */
        .access-denied-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .access-denied-overlay.active {
            display: flex;
        }
        
        .access-denied-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }
        
        .access-denied-card i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .access-denied-card h2 {
            font-size: 2rem;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .access-denied-card p {
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.6;
        }
        
        .access-denied-card .features-list {
            text-align: left;
            background: var(--light-gray);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
        }
        
        .access-denied-card .features-list li {
            list-style: none;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .access-denied-card .features-list i {
            font-size: 1rem;
            color: var(--success);
            margin: 0;
        }

        /* ===== NAVIGATION ===== */
        nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-container { 
            max-width: 1400px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 32px; 
        }
        
        .nav-logo { 
            font-weight: 800; 
            font-size: 1.4rem; 
            color: var(--primary-dark);
            text-decoration: none; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .nav-links { 
            display: flex; 
            gap: 24px; 
            align-items: center; 
        }
        
        .nav-links a { 
            text-decoration: none; 
            color: var(--text-secondary); 
            font-size: 0.95rem; 
            font-weight: 500; 
            transition: var(--transition); 
            padding: 6px 0;
        }
        
        .nav-links a:hover { 
            color: var(--primary-dark); 
        }
        
        .nav-links a.active { 
            color: var(--primary-dark); 
            font-weight: 600;
            border-bottom: 2px solid var(--primary);
        }
        
        .back-btn { 
            background: var(--dark); 
            color: white !important; 
            padding: 8px 20px !important; 
            border-radius: 40px; 
            font-weight: 500 !important;
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 32px;
        }

        /* ===== WELCOME HEADER ===== */
        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }
        
        .welcome-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .welcome-title p {
            color: var(--text-muted);
            font-size: 1rem;
        }
        
        .date-badge {
            background: white;
            padding: 8px 20px;
            border-radius: 40px;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ===== QUICK STATS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--card-radius);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: var(--transition);
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .stat-content p {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ===== SEARCH SECTION ===== */
        .search-section {
            margin-bottom: 24px;
        }
        
        .search-container {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 4px 4px 4px 20px;
            max-width: 400px;
        }
        
        .search-input {
            flex: 1;
            border: none;
            padding: 12px;
            font-size: 0.95rem;
            background: transparent;
            outline: none;
        }
        
        .search-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
        }

        /* ===== CONNECTED ACCOUNTS SECTION ===== */
        .section-card {
            background: white;
            border-radius: var(--card-radius);
            border: 1px solid var(--border-color);
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .section-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-header h2 i {
            color: var(--primary);
        }
        
        .connect-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: var(--button-radius);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ===== SCROLLABLE ACCOUNTS GRID ===== */
        .accounts-scroll {
            overflow-x: auto;
            padding-bottom: 8px;
            margin-bottom: -8px;
        }
        
        .accounts-scroll::-webkit-scrollbar {
            height: 6px;
        }
        
        .accounts-scroll::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 10px;
        }
        
        .accounts-scroll::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }
        
        .accounts-grid {
            display: flex;
            gap: 16px;
            min-width: min-content;
        }

        .account-card {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            width: 280px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
            background: white;
            flex-shrink: 0;
        }
        
        .account-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .account-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .account-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .account-details h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .account-details p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .account-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-badge {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .icon-btn:hover {
            background: var(--light-gray);
            border-color: var(--primary);
        }

        /* ===== AUTOMATIONS STATUS SECTION ===== */
        .automations-status {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .status-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
        }
        
        .status-info h4 {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 2px;
        }
        
        .status-info .count {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ===== FEATURE TABS ===== */
        .feature-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .feature-tab {
            padding: 8px 16px;
            border-radius: 30px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .feature-tab:hover {
            border-color: var(--primary);
            color: var(--primary-dark);
        }
        
        .feature-tab.active {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        /* ===== FEATURES GRID ===== */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .feature-card {
            background: white;
            border-radius: var(--card-radius);
            border: 1px solid var(--border-color);
            padding: 20px;
            transition: var(--transition);
        }

        .feature-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 16px;
        }

        .feature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .feature-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .feature-badge {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 30px;
            background: var(--success-light);
            color: var(--success);
            font-weight: 600;
        }
        
        .feature-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .feature-stats {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .stat {
            flex: 1;
            text-align: center;
        }
        
        .stat-value {
            font-weight: 600;
            color: var(--primary);
            font-size: 1rem;
        }
        
        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .feature-action {
            display: flex;
            gap: 10px;
        }
        
        .btn-primary {
            flex: 1;
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 10px;
            border-radius: var(--button-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
        }
        
        .btn-outline {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: var(--button-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary-dark);
        }

        /* ===== ANALYTICS SECTION ===== */
        .analytics-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }

        .chart-card {
            background: white;
            border-radius: var(--card-radius);
            border: 1px solid var(--border-color);
            padding: 16px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .chart-title {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .chart-legend {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .legend-color {
            width: 8px;
            height: 8px;
            border-radius: 4px;
        }
        
        canvas {
            max-height: 150px !important;
            width: 100% !important;
        }

        /* ===== ACTIVITY LOG ===== */
        .activity-log {
            background: white;
            border-radius: var(--card-radius);
            border: 1px solid var(--border-color);
            padding: 16px;
            max-height: 220px;
            overflow-y: auto;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            position: sticky;
            top: 0;
            background: white;
            padding-bottom: 8px;
        }
        
        .log-entry {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 0.8rem;
        }
        
        .log-content {
            flex: 1;
        }
        
        .log-title {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .log-time {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--card-radius);
            width: 90%;
            max-width: 500px;
            padding: 32px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
        }
        
        .platform-options-scroll {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 8px;
        }
        
        .platform-options-scroll::-webkit-scrollbar {
            width: 4px;
        }
        
        .platform-options-scroll::-webkit-scrollbar-track {
            background: var(--light-gray);
        }
        
        .platform-options-scroll::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
        }
        
        .platform-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .platform-option {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .platform-option:hover {
            border-color: var(--primary);
        }
        
        .platform-option.selected {
            border: 2px solid var(--primary);
            background: var(--primary-light);
        }
        
        .platform-option i {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .platform-option p {
            font-size: 0.85rem;
        }
        
        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .modal-footer button {
            flex: 1;
            padding: 12px;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: white;
            border-radius: 8px;
            padding: 12px 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            font-size: 0.9rem;
            max-width: 350px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== LOADING SPINNER ===== */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(212,175,55,0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            .automations-status {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .nav-container { flex-direction: column; gap: 12px; }
            .stats-grid,
            .features-grid,
            .automations-status {
                grid-template-columns: 1fr;
            }
            .welcome-header { flex-direction: column; align-items: start; gap: 12px; }
            .section-header { flex-direction: column; align-items: start; }
        }
    </style>
</head>
<body>

<!-- Access Denied Overlay -->
<div class="access-denied-overlay" id="accessDeniedOverlay">
    <div class="access-denied-card">
        <i class="fas fa-crown"></i>
        <h2>Pro or Agency Plan Required</h2>
        <p>Unlock the full power of AI Automation Powerhouse 2.0 with our Pro or Agency plan:</p>
        <div class="features-list">
            <li><i class="fas fa-check-circle"></i> Computer Vision AI - 98.5% accuracy</li>
            <li><i class="fas fa-check-circle"></i> Anti-Detection Engine - 10K+ proxies</li>
            <li><i class="fas fa-check-circle"></i> Unified Lead Brain - Cross-platform scoring</li>
            <li><i class="fas fa-check-circle"></i> Cloud Mobile Simulation - 1,000+ instances</li>
            <li><i class="fas fa-check-circle"></i> Price Intelligence - Real-time competitor tracking</li>
            <li><i class="fas fa-check-circle"></i> Agentic Workflows - Autonomous AI agents</li>
        </div>
        <button class="btn-primary" onclick="window.location.href='pricing.html'" style="padding: 16px 40px; width: 100%;">
            <i class="fas fa-arrow-up"></i> Upgrade Now
        </button>
        <button class="btn-secondary" onclick="window.location.href='ai-automations.html'" style="margin-top: 12px; width: 100%;">
            <i class="fas fa-arrow-left"></i> Back to Automations
        </button>
    </div>
</div>

<nav>
    <div class="nav-container">
        <a href="dashboard.html" class="nav-logo">
            <i class="fas fa-bolt" style="color: var(--primary);"></i>
            AI Powerhouse 2.0
        </a>
        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="#" class="active">Automations</a>
            <a href="analytics.html">Analytics</a>
            <a href="settings.html">Settings</a>
            <a href="ai-automations.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</nav>

<div class="container" id="mainContent">
    <!-- Welcome Header -->
    <div class="welcome-header">
        <div class="welcome-title">
            <h1>Welcome back, <span id="userName">loading...</span> ðŸ‘‹</h1>
            <p>Your AI automation hub is running 24/7 with <span id="activeAgentsDisplay">0</span> active agents</p>
        </div>
        <div class="date-badge">
            <i class="far fa-calendar" style="color: var(--primary);"></i>
            <span id="currentDate"></span>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-robot"></i></div>
            <div class="stat-content">
                <h3 id="activeAgents">0</h3>
                <p>Active Agents</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-eye"></i></div>
            <div class="stat-content">
                <h3 id="imagesProcessed">0</h3>
                <p>Images Today</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-content">
                <h3 id="totalLeads">0</h3>
                <p>Leads Generated</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-clock"></i></div>
            <div class="stat-content">
                <h3 id="hoursSaved">0</h3>
                <p>Hours Saved</p>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="search-section">
        <div class="search-container">
            <input type="text" id="platformSearch" class="search-input" placeholder="Search platforms or features..." oninput="searchPlatforms()">
            <button class="search-btn" onclick="searchPlatforms()"><i class="fas fa-search"></i></button>
        </div>
    </div>

    <!-- Connected Accounts Section -->
    <div class="section-card">
        <div class="section-header">
            <h2><i class="fas fa-link"></i> Connected Platforms</h2>
            <button class="connect-btn" onclick="showConnectModal()">
                <i class="fas fa-plus"></i> Connect New Account
            </button>
        </div>
        
        <div class="accounts-scroll">
            <div class="accounts-grid" id="accountsGrid">
                <div style="padding: 20px; text-align: center; width: 100%;">
                    <div class="loading-spinner"></div> Loading accounts...
                </div>
            </div>
        </div>
    </div>

    <!-- Automations Status -->
    <div class="automations-status" id="automationsStatus">
        <div class="status-card">
            <div class="status-icon"><i class="fas fa-play-circle"></i></div>
            <div class="status-info">
                <h4>Live Automations</h4>
                <div class="count" id="liveCount">0</div>
            </div>
        </div>
        <div class="status-card">
            <div class="status-icon"><i class="fas fa-pause-circle"></i></div>
            <div class="status-info">
                <h4>Paused Automations</h4>
                <div class="count" id="pausedCount">0</div>
            </div>
        </div>
        <div class="status-card">
            <div class="status-icon"><i class="fas fa-clock"></i></div>
            <div class="status-info">
                <h4>Total Runs Today</h4>
                <div class="count" id="totalRuns">0</div>
            </div>
        </div>
    </div>

    <!-- Feature Tabs -->
    <div class="feature-tabs">
        <button class="feature-tab active" onclick="filterFeatures('all')">All Features</button>
        <button class="feature-tab" onclick="filterFeatures('ecommerce')">E-Commerce</button>
        <button class="feature-tab" onclick="filterFeatures('crm')">CRM & Sales</button>
        <button class="feature-tab" onclick="filterFeatures('marketing')">Marketing</button>
        <button class="feature-tab" onclick="filterFeatures('support')">Customer Support</button>
        <button class="feature-tab" onclick="filterFeatures('finance')">Finance</button>
        <button class="feature-tab" onclick="filterFeatures('hr')">HR</button>
        <button class="feature-tab" onclick="filterFeatures('project')">Project Mgmt</button>
        <button class="feature-tab" onclick="filterFeatures('social')">Social Media</button>
    </div>

    <!-- Features Grid -->
    <div class="features-grid" id="featuresGrid"></div>

    <!-- Analytics Section -->
    <div class="analytics-grid">
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title">Platform Performance (Last 7 Days)</span>
                <div class="chart-legend">
                    <span class="legend-item">
                        <span class="legend-color" style="background: var(--primary);"></span>
                        Views
                    </span>
                    <span class="legend-item">
                        <span class="legend-color" style="background: var(--info);"></span>
                        Engagement
                    </span>
                </div>
            </div>
            <canvas id="performanceChart"></canvas>
        </div>
        
        <div class="activity-log" id="activityLog">
            <div class="log-header">
                <span class="chart-title">Recent Activity</span>
                <span style="color: var(--text-muted); font-size: 0.75rem;">Live</span>
            </div>
            <div style="padding: 20px; text-align: center;">
                <div class="loading-spinner"></div> Loading activity...
            </div>
        </div>
    </div>
</div>

<!-- Connect Account Modal -->
<div class="modal" id="connectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Connect New Platform</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        
        <div class="platform-options-scroll">
            <div class="platform-options" id="platformOptions"></div>
        </div>
        
        <div class="form-group">
            <label>Account Name</label>
            <input type="text" id="accountName" class="form-control" placeholder="e.g., My Business Account">
        </div>
        
        <div class="form-group">
            <label>API Key / Access Token</label>
            <input type="password" id="apiKey" class="form-control" placeholder="Enter your API key">
        </div>
        
        <div class="form-group" id="additionalFields" style="display: none;">
            <!-- Additional fields will be added here dynamically based on platform -->
        </div>
        
        <div class="modal-footer">
            <button class="btn-outline" onclick="closeModal()">Cancel</button>
            <button class="btn-primary" onclick="connectAccount()">Connect Account</button>
        </div>
    </div>
</div>

<script>
// ================================================
// AI AUTOMATION POWERHOUSE 2.0 - PRODUCTION READY
// REAL ACCOUNT CONNECTIONS, VALIDATION, LIVE UPDATES
// ================================================

const BACKEND_URL = window.BACKEND_URL || 'https://ai-smart-hub.onrender.com';
const API_BASE = `${BACKEND_URL}/api`;

// Admin email
const ADMIN_EMAIL = "ericchung992@gmail.com";

// Global state
let activeAgents = 0;
let imagesProcessed = 0;
let totalLeads = 0;
let hoursSaved = 0;
let performanceChart;
let selectedPlatform = null;
let userData = {};
let userPlan = 'free';
let automationStats = {};
let connectedAccounts = [];
let recentActivity = [];
let userAutomations = [];

// Platform-specific validation rules
const platformValidation = {
    shopify: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,64}$/,
        additionalFields: ['shopName'],
        validate: (data) => {
            return data.apiKey && data.shopName && data.shopName.includes('.myshopify.com');
        }
    },
    stripe: { 
        apiKeyFormat: /^sk_live_[a-zA-Z0-9]{24,}$/,
        additionalFields: [],
        validate: (data) => data.apiKey.startsWith('sk_live_') || data.apiKey.startsWith('sk_test_')
    },
    mailchimp: { 
        apiKeyFormat: /^[a-f0-9]{32}-[a-z]{2}$/,
        additionalFields: [],
        validate: (data) => data.apiKey.includes('-')
    },
    slack: { 
        apiKeyFormat: /^xox[baprs]-[a-zA-Z0-9-]{10,}$/,
        additionalFields: ['teamName'],
        validate: (data) => data.apiKey.startsWith('xox')
    },
    tiktok: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['accessToken'],
        validate: (data) => data.apiKey.length > 20
    },
    instagram: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['businessId'],
        validate: (data) => data.apiKey && data.businessId
    },
    youtube: { 
        apiKeyFormat: /^[a-zA-Z0-9]{39,}$/,
        additionalFields: ['channelId'],
        validate: (data) => data.apiKey && data.channelId
    },
    facebook: { 
        apiKeyFormat: /^[a-zA-Z0-9]{50,}$/,
        additionalFields: ['pageId'],
        validate: (data) => data.apiKey && data.pageId
    },
    twitter: { 
        apiKeyFormat: /^[a-zA-Z0-9]{50,}$/,
        additionalFields: ['bearerToken'],
        validate: (data) => data.apiKey
    },
    linkedin: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['companyId'],
        validate: (data) => data.apiKey && data.companyId
    },
    pinterest: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: [],
        validate: (data) => data.apiKey
    },
    snapchat: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,}$/,
        additionalFields: ['adAccountId'],
        validate: (data) => data.apiKey && data.adAccountId
    },
    reddit: { 
        apiKeyFormat: /^[a-zA-Z0-9_-]{20,}$/,
        additionalFields: ['clientId', 'clientSecret'],
        validate: (data) => data.clientId && data.clientSecret
    },
    twitch: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['clientId'],
        validate: (data) => data.apiKey && data.clientId
    },
    douyin: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,}$/,
        additionalFields: ['openId'],
        validate: (data) => data.apiKey && data.openId
    },
    wechat: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,}$/,
        additionalFields: ['appId', 'appSecret'],
        validate: (data) => data.appId && data.appSecret
    },
    weibo: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,}$/,
        additionalFields: ['uid'],
        validate: (data) => data.apiKey && data.uid
    },
    xiaohongshu: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,}$/,
        additionalFields: ['userId'],
        validate: (data) => data.apiKey && data.userId
    },
    bilibili: { 
        apiKeyFormat: /^[a-zA-Z0-9]{32,}$/,
        additionalFields: ['accessKey'],
        validate: (data) => data.apiKey && data.accessKey
    },
    woocommerce: { 
        apiKeyFormat: /^ck_[a-f0-9]{32,}$/,
        additionalFields: ['consumerSecret', 'storeUrl'],
        validate: (data) => data.apiKey && data.consumerSecret && data.storeUrl
    },
    magento: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['accessToken', 'storeUrl'],
        validate: (data) => data.apiKey && data.accessToken && data.storeUrl
    },
    bigcommerce: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['clientId', 'accessToken', 'storeHash'],
        validate: (data) => data.apiKey && data.clientId && data.accessToken && data.storeHash
    },
    amazon: { 
        apiKeyFormat: /^[a-zA-Z0-9]{50,}$/,
        additionalFields: ['sellerId', 'marketplaceId'],
        validate: (data) => data.apiKey && data.sellerId && data.marketplaceId
    },
    ebay: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['clientId', 'clientSecret', 'ruName'],
        validate: (data) => data.clientId && data.clientSecret && data.ruName
    },
    etsy: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['keystring', 'sharedSecret'],
        validate: (data) => data.keystring && data.sharedSecret
    },
    paypal: { 
        apiKeyFormat: /^[a-zA-Z0-9]{50,}$/,
        additionalFields: ['clientId', 'clientSecret'],
        validate: (data) => data.clientId && data.clientSecret
    },
    square: { 
        apiKeyFormat: /^[a-zA-Z0-9]{50,}$/,
        additionalFields: ['accessToken', 'locationId'],
        validate: (data) => data.accessToken && data.locationId
    },
    quickbooks: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['clientId', 'clientSecret', 'realmId'],
        validate: (data) => data.clientId && data.clientSecret && data.realmId
    },
    xero: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['clientId', 'clientSecret', 'tenantId'],
        validate: (data) => data.clientId && data.clientSecret && data.tenantId
    },
    salesforce: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['clientId', 'clientSecret', 'instanceUrl'],
        validate: (data) => data.clientId && data.clientSecret && data.instanceUrl
    },
    hubspot: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['portalId'],
        validate: (data) => data.apiKey && data.portalId
    },
    zoho: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['clientId', 'clientSecret', 'organizationId'],
        validate: (data) => data.clientId && data.clientSecret && data.organizationId
    },
    pipedrive: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['companyDomain'],
        validate: (data) => data.apiKey && data.companyDomain
    },
    freshsales: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['domain'],
        validate: (data) => data.apiKey && data.domain
    },
    klaviyo: { 
        apiKeyFormat: /^pk_[a-f0-9]{32,}$/,
        additionalFields: ['privateKey'],
        validate: (data) => data.apiKey && data.privateKey
    },
    activecampaign: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['apiUrl'],
        validate: (data) => data.apiKey && data.apiUrl
    },
    convertkit: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['apiSecret'],
        validate: (data) => data.apiKey && data.apiSecret
    },
    discord: { 
        apiKeyFormat: /^[a-zA-Z0-9_-]{24,}$/,
        additionalFields: ['botToken'],
        validate: (data) => data.botToken
    },
    telegram: { 
        apiKeyFormat: /^[0-9]{8,}:[a-zA-Z0-9_-]{35,}$/,
        additionalFields: ['botName'],
        validate: (data) => data.apiKey.includes(':')
    },
    whatsapp: { 
        apiKeyFormat: /^[a-zA-Z0-9]{30,}$/,
        additionalFields: ['phoneNumberId', 'businessAccountId'],
        validate: (data) => data.phoneNumberId && data.businessAccountId
    },
    asana: { 
        apiKeyFormat: /^[0-9]{16,}\/[a-f0-9]{32,}$/,
        additionalFields: ['workspaceId'],
        validate: (data) => data.apiKey && data.workspaceId
    },
    trello: { 
        apiKeyFormat: /^[a-f0-9]{32,}$/,
        additionalFields: ['token', 'boardId'],
        validate: (data) => data.apiKey && data.token
    },
    jira: { 
        apiKeyFormat: /^[a-zA-Z0-9]{24,}$/,
        additionalFields: ['email', 'domain'],
        validate: (data) => data.email && data.apiKey && data.domain
    },
    monday: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['workspaceId'],
        validate: (data) => data.apiKey
    },
    notion: { 
        apiKeyFormat: /^secret_[a-zA-Z0-9]{40,}$/,
        additionalFields: ['databaseId'],
        validate: (data) => data.apiKey.startsWith('secret_')
    },
    bamboo: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['companyDomain', 'apiKey'],
        validate: (data) => data.apiKey && data.companyDomain
    },
    workday: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['tenant', 'clientId', 'clientSecret'],
        validate: (data) => data.tenant && data.clientId && data.clientSecret
    },
    gusto: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['companyId'],
        validate: (data) => data.apiKey && data.companyId
    },
    zendesk: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['subdomain', 'email'],
        validate: (data) => data.subdomain && data.email && data.apiKey
    },
    intercom: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['appId'],
        validate: (data) => data.apiKey && data.appId
    },
    freshdesk: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['domain'],
        validate: (data) => data.apiKey && data.domain
    },
    helpscout: { 
        apiKeyFormat: /^[a-f0-9]{40,}$/,
        additionalFields: ['mailboxId'],
        validate: (data) => data.apiKey && data.mailboxId
    }
};

// Complete Platform data
const platforms = [
    // Social Media
    { id: 'tiktok', name: 'TikTok', icon: 'fab fa-tiktok', color: '#010101', category: 'social' },
    { id: 'instagram', name: 'Instagram', icon: 'fab fa-instagram', color: '#d62976', category: 'social' },
    { id: 'youtube', name: 'YouTube', icon: 'fab fa-youtube', color: '#ff0000', category: 'video' },
    { id: 'facebook', name: 'Facebook', icon: 'fab fa-facebook', color: '#4267B2', category: 'social' },
    { id: 'twitter', name: 'X (Twitter)', icon: 'fab fa-twitter', color: '#1da1f2', category: 'social' },
    { id: 'linkedin', name: 'LinkedIn', icon: 'fab fa-linkedin', color: '#0077b5', category: 'professional' },
    { id: 'pinterest', name: 'Pinterest', icon: 'fab fa-pinterest', color: '#E60023', category: 'visual' },
    { id: 'snapchat', name: 'Snapchat', icon: 'fab fa-snapchat', color: '#FFFC00', category: 'social' },
    { id: 'reddit', name: 'Reddit', icon: 'fab fa-reddit', color: '#FF4500', category: 'forum' },
    { id: 'tumblr', name: 'Tumblr', icon: 'fab fa-tumblr', color: '#36465D', category: 'blog' },
    { id: 'twitch', name: 'Twitch', icon: 'fab fa-twitch', color: '#9146FF', category: 'streaming' },
    
    // Chinese Platforms
    { id: 'douyin', name: 'Douyin', icon: 'fas fa-music', color: '#000000', category: 'social' },
    { id: 'wechat', name: 'WeChat', icon: 'fab fa-weixin', color: '#07c160', category: 'chat' },
    { id: 'weibo', name: 'Weibo', icon: 'fab fa-weibo', color: '#E6162D', category: 'social' },
    { id: 'xiaohongshu', name: 'Xiaohongshu', icon: 'fas fa-heart', color: '#FF5A5F', category: 'social' },
    { id: 'bilibili', name: 'Bilibili', icon: 'fas fa-play', color: '#FB7299', category: 'video' },
    
    // E-Commerce
    { id: 'shopify', name: 'Shopify', icon: 'fab fa-shopify', color: '#7AB55C', category: 'ecommerce' },
    { id: 'woocommerce', name: 'WooCommerce', icon: 'fab fa-wordpress', color: '#96588A', category: 'ecommerce' },
    { id: 'magento', name: 'Magento', icon: 'fas fa-shopping-cart', color: '#F26322', category: 'ecommerce' },
    { id: 'bigcommerce', name: 'BigCommerce', icon: 'fas fa-store', color: '#1A4A7A', category: 'ecommerce' },
    { id: 'amazon', name: 'Amazon Seller', icon: 'fab fa-amazon', color: '#FF9900', category: 'ecommerce' },
    { id: 'ebay', name: 'eBay', icon: 'fab fa-ebay', color: '#E53238', category: 'ecommerce' },
    { id: 'etsy', name: 'Etsy', icon: 'fas fa-etsy', color: '#F16521', category: 'ecommerce' },
    
    // Payment & Finance
    { id: 'stripe', name: 'Stripe', icon: 'fab fa-stripe', color: '#635BFF', category: 'finance' },
    { id: 'paypal', name: 'PayPal', icon: 'fab fa-paypal', color: '#00457C', category: 'finance' },
    { id: 'square', name: 'Square', icon: 'fas fa-square', color: '#3E4348', category: 'finance' },
    { id: 'quickbooks', name: 'QuickBooks', icon: 'fas fa-calculator', color: '#2CA01C', category: 'finance' },
    { id: 'xero', name: 'Xero', icon: 'fas fa-chart-line', color: '#13B5EA', category: 'finance' },
    
    // CRM & Sales
    { id: 'salesforce', name: 'Salesforce', icon: 'fab fa-salesforce', color: '#00A1E0', category: 'crm' },
    { id: 'hubspot', name: 'HubSpot', icon: 'fab fa-hubspot', color: '#FF7A59', category: 'crm' },
    { id: 'zoho', name: 'Zoho', icon: 'fas fa-z', color: '#C8202B', category: 'crm' },
    { id: 'pipedrive', name: 'Pipedrive', icon: 'fas fa-pipe', color: '#00B39F', category: 'crm' },
    { id: 'freshsales', name: 'Freshsales', icon: 'fas fa-leaf', color: '#00A82D', category: 'crm' },
    
    // Marketing
    { id: 'mailchimp', name: 'Mailchimp', icon: 'fab fa-mailchimp', color: '#FFE01B', category: 'marketing' },
    { id: 'klaviyo', name: 'Klaviyo', icon: 'fas fa-envelope', color: '#24A25D', category: 'marketing' },
    { id: 'activecampaign', name: 'ActiveCampaign', icon: 'fas fa-campaign', color: '#6A1B9A', category: 'marketing' },
    { id: 'convertkit', name: 'ConvertKit', icon: 'fas fa-kit', color: '#FB6970', category: 'marketing' },
    
    // Communication
    { id: 'slack', name: 'Slack', icon: 'fab fa-slack', color: '#4A154B', category: 'communication' },
    { id: 'discord', name: 'Discord', icon: 'fab fa-discord', color: '#5865F2', category: 'communication' },
    { id: 'telegram', name: 'Telegram', icon: 'fab fa-telegram', color: '#26A5E4', category: 'communication' },
    { id: 'whatsapp', name: 'WhatsApp', icon: 'fab fa-whatsapp', color: '#25D366', category: 'communication' },
    
    // Project Management
    { id: 'asana', name: 'Asana', icon: 'fas fa-asana', color: '#F06A6A', category: 'project' },
    { id: 'trello', name: 'Trello', icon: 'fab fa-trello', color: '#0079BF', category: 'project' },
    { id: 'jira', name: 'Jira', icon: 'fab fa-jira', color: '#0052CC', category: 'project' },
    { id: 'monday', name: 'Monday.com', icon: 'fas fa-calendar', color: '#FF6F61', category: 'project' },
    { id: 'notion', name: 'Notion', icon: 'fas fa-notion', color: '#000000', category: 'project' },
    
    // HR & People
    { id: 'bamboo', name: 'BambooHR', icon: 'fas fa-bamboo', color: '#005B96', category: 'hr' },
    { id: 'workday', name: 'Workday', icon: 'fas fa-work', color: '#F05A28', category: 'hr' },
    { id: 'gusto', name: 'Gusto', icon: 'fas fa-gusto', color: '#F1C40F', category: 'hr' },
    
    // Customer Support
    { id: 'zendesk', name: 'Zendesk', icon: 'fab fa-zendesk', color: '#03363D', category: 'support' },
    { id: 'intercom', name: 'Intercom', icon: 'fas fa-intercom', color: '#6A1B9A', category: 'support' },
    { id: 'freshdesk', name: 'Freshdesk', icon: 'fas fa-desk', color: '#00A82D', category: 'support' },
    { id: 'helpscout', name: 'HelpScout', icon: 'fas fa-help', color: '#1297E0', category: 'support' }
];

// ===== TOKEN HELPERS =====
function getPlanFromToken() {
    try {
        const token = localStorage.getItem('token');
        if (!token) return null;
        const parts = token.split('.');
        if (parts.length !== 3) return null;
        return JSON.parse(atob(parts[1]));
    } catch (e) {
        return null;
    }
}

// ===== CHECK ACCESS =====
async function checkAccess() {
    try {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
            return false;
        }

        const payload = getPlanFromToken();
        if (payload) {
            userPlan = (payload.plan || 'free').toLowerCase();
            if (payload.email === ADMIN_EMAIL) return true;
            if (userPlan === 'pro' || userPlan === 'agency') return true;
        }

        const response = await fetch(`${BACKEND_URL}/api/dashboard/full`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!response.ok) throw new Error('Failed to fetch plan');

        const data = await response.json();
        userPlan = (data.plan || 'free').toLowerCase();
        
        if (userPlan === 'pro' || userPlan === 'agency' || data.email === ADMIN_EMAIL) {
            return true;
        }
        return false;
    } catch (err) {
        console.error("[ACCESS CHECK ERROR]", err);
        return false;
    }
}

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', async function() {
    console.log('ðŸš€ AI Automation Powerhouse 2.0 Starting...');
    
    const hasAccess = await checkAccess();
    if (!hasAccess) {
        document.getElementById('accessDeniedOverlay').classList.add('active');
        return;
    }
    
    updateDate();
    await loadUserData();
    initCharts();
    await loadAllData();
    loadPlatformOptions();
    startLiveUpdates();
    renderFeatures();
});

// ===== LOAD ALL DATA =====
async function loadAllData() {
    try {
        document.getElementById('accountsGrid').innerHTML = '<div style="padding: 20px; text-align: center; width: 100%;"><div class="loading-spinner"></div> Loading accounts...</div>';
        document.getElementById('activityLog').innerHTML = '<div style="padding: 20px; text-align: center;"><div class="loading-spinner"></div> Loading activity...</div>';
        
        await Promise.all([
            loadStats(),
            loadConnectedAccounts(),
            loadActivityLog(),
            loadUserAutomations()
        ]);
        
    } catch (error) {
        console.error('Error loading data:', error);
        showToast('âš ï¸ Failed to load some data. Please refresh.', 'error');
    }
}

// ===== LOAD USER AUTOMATIONS =====
async function loadUserAutomations() {
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
            userAutomations = await response.json();
            const live = userAutomations.filter(a => a.status === 'active').length;
            const paused = userAutomations.filter(a => a.status === 'paused').length;
            const today = userAutomations.filter(a => {
                const lastRun = new Date(a.last_run || 0);
                const today = new Date();
                return lastRun.toDateString() === today.toDateString();
            }).length;
            
            document.getElementById('liveCount').textContent = live;
            document.getElementById('pausedCount').textContent = paused;
            document.getElementById('totalRuns').textContent = today;
        }
    } catch (error) {
        console.error('Error loading automations:', error);
    }
}

// ===== LOAD STATS =====
async function loadStats() {
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/stats`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
            const stats = await response.json();
            activeAgents = stats.activeAgents || 0;
            imagesProcessed = stats.imagesProcessed || 0;
            totalLeads = stats.totalLeads || 0;
            hoursSaved = stats.hoursSaved || 0;
            automationStats = stats;
        }
    } catch (error) {
        console.error('Error loading stats:', error);
    }
    
    updateStats();
}

// ===== LOAD USER DATA =====
async function loadUserData() {
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/user/profile`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            userData = await response.json();
            document.getElementById('userName').textContent = userData.business_name || userData.name || 'User';
        }
    } catch (error) {
        document.getElementById('userName').textContent = 'User';
    }
}

// ===== UPDATE DATE =====
function updateDate() {
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);
}

// ===== INIT CHARTS =====
function initCharts() {
    const ctx = document.getElementById('performanceChart')?.getContext('2d');
    if (!ctx) return;
    
    performanceChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [
                {
                    label: 'Views',
                    data: [12400, 18900, 23400, 27800, 31200, 35600, 38900],
                    borderColor: '#d4af37',
                    backgroundColor: 'rgba(212,175,55,0.1)',
                    borderWidth: 2,
                    pointRadius: 2,
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'Engagement',
                    data: [3200, 4100, 5300, 6200, 7100, 8300, 9100],
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37,99,235,0.1)',
                    borderWidth: 2,
                    pointRadius: 2,
                    tension: 0.3,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { display: false } },
                x: { grid: { display: false } }
            }
        }
    });
}

// ===== UPDATE STATS =====
function updateStats() {
    document.getElementById('activeAgents').textContent = activeAgents.toLocaleString();
    document.getElementById('activeAgentsDisplay').textContent = activeAgents.toLocaleString();
    document.getElementById('imagesProcessed').textContent = imagesProcessed.toLocaleString();
    document.getElementById('totalLeads').textContent = totalLeads.toLocaleString();
    document.getElementById('hoursSaved').textContent = hoursSaved.toLocaleString();
}

// ===== LIVE UPDATES =====
function startLiveUpdates() {
    setInterval(async () => {
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_BASE}/automations/stats`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (response.ok) {
                const stats = await response.json();
                activeAgents = stats.activeAgents || 0;
                imagesProcessed = stats.imagesProcessed || 0;
                totalLeads = stats.totalLeads || 0;
                hoursSaved = stats.hoursSaved || 0;
                updateStats();
            }
            await loadUserAutomations();
        } catch (error) {
            console.debug('Live update failed, will retry');
        }
    }, 30000);
}

// ===== LOAD CONNECTED ACCOUNTS =====
async function loadConnectedAccounts() {
    const grid = document.getElementById('accountsGrid');
    
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/accounts`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
            const accounts = await response.json();
            connectedAccounts = accounts;
            
            if (accounts.length === 0) {
                grid.innerHTML = '<div style="padding: 40px; text-align: center; width: 100%; color: var(--text-muted);"><i class="fas fa-plug fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i><h3>No accounts connected</h3><p>Connect your first platform to start automating</p><button class="btn-primary" onclick="showConnectModal()" style="margin-top: 15px;"><i class="fas fa-plus"></i> Connect Account</button></div>';
                return;
            }
            
            grid.innerHTML = accounts.map(account => {
                const platform = platforms.find(p => p.id === account.platform) || { 
                    icon: 'fas fa-plug', 
                    color: '#64748b',
                    name: account.platform || 'Unknown'
                };
                
                let accountInfo = account.account_info || {};
                if (typeof accountInfo === 'string') {
                    try {
                        accountInfo = JSON.parse(accountInfo);
                    } catch (e) {
                        accountInfo = {};
                    }
                }
                
                let metrics = 'Connected';
                if (accountInfo) {
                    if (account.platform === 'shopify') metrics = `${accountInfo.orders || 0} orders â€¢ $${accountInfo.revenue || 0}`;
                    else if (account.platform === 'stripe') metrics = `$${accountInfo.revenue || 0} revenue â€¢ ${accountInfo.customers || 0} customers`;
                    else if (account.platform === 'mailchimp') metrics = `${accountInfo.subscribers || 0} subscribers â€¢ ${accountInfo.campaigns || 0} campaigns`;
                    else if (account.platform === 'slack') metrics = `${accountInfo.members || 0} members â€¢ ${accountInfo.channels || 0} channels`;
                    else if (account.platform === 'salesforce') metrics = `${accountInfo.leads || 0} leads â€¢ ${accountInfo.opportunities || 0} opportunities`;
                    else if (account.platform === 'hubspot') metrics = `${accountInfo.contacts || 0} contacts â€¢ ${accountInfo.deals || 0} deals`;
                    else if (accountInfo.followers) metrics = `${accountInfo.followers} followers â€¢ ${accountInfo.engagement || 0} engagement`;
                    else if (accountInfo.orders) metrics = `${accountInfo.orders} orders â€¢ $${accountInfo.revenue || 0}`;
                    else if (accountInfo.revenue) metrics = `$${accountInfo.revenue} revenue`;
                }
                
                const accountName = account.account_name || account.name || platform.name;
                const lastSync = account.last_sync ? new Date(account.last_sync).toLocaleString() : 'Never';
                
                return `
                    <div class="account-card">
                        <div class="account-info">
                            <div class="account-avatar" style="background: ${platform.color};">
                                <i class="${platform.icon}"></i>
                            </div>
                            <div class="account-details">
                                <h4>${accountName}</h4>
                                <p>${platform.name} â€¢ ${metrics}</p>
                                <small style="color: var(--text-muted); font-size: 0.7rem;">Last sync: ${lastSync}</small>
                            </div>
                        </div>
                        <div class="account-status">
                            <span class="status-badge" style="background: ${account.status === 'active' ? 'var(--success)' : 'var(--warning)'};"></span>
                            <button class="icon-btn" onclick="configureAccount('${account.platform}')">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        } else {
            throw new Error('Failed to fetch accounts');
        }
    } catch (error) {
        console.error('Error loading accounts:', error);
        grid.innerHTML = '<div style="padding: 40px; text-align: center; width: 100%; color: var(--text-muted);"><i class="fas fa-exclamation-triangle fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i><h3>Failed to load accounts</h3><p>Please try again later</p><button class="btn-primary" onclick="loadConnectedAccounts()" style="margin-top: 10px;">Retry</button></div>';
    }
}

// ===== LOAD PLATFORM OPTIONS =====
function loadPlatformOptions() {
    const optionsDiv = document.getElementById('platformOptions');
    if (!optionsDiv) return;
    
    optionsDiv.innerHTML = platforms.map(p => `
        <div class="platform-option" onclick="selectPlatform('${p.id}')" data-platform="${p.id}">
            <i class="${p.icon}" style="color: ${p.color};"></i>
            <p>${p.name}</p>
        </div>
    `).join('');
}

// ===== SEARCH PLATFORMS =====
function searchPlatforms() {
    const searchTerm = document.getElementById('platformSearch').value.toLowerCase().trim();
    const accountCards = document.querySelectorAll('.account-card');
    const featureCards = document.querySelectorAll('.feature-card');
    
    if (searchTerm === '') {
        accountCards.forEach(card => card.style.display = 'flex');
        featureCards.forEach(card => card.style.display = 'block');
        return;
    }
    
    accountCards.forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(searchTerm) ? 'flex' : 'none';
    });
    
    featureCards.forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(searchTerm) ? 'block' : 'none';
    });
    
    showToast(`ðŸ” Searching for "${searchTerm}"`, 'info');
}

// ===== FILTER FEATURES =====
function filterFeatures(category) {
    document.querySelectorAll('.feature-tab').forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');
    
    const cards = document.querySelectorAll('.feature-card');
    cards.forEach(card => {
        card.style.display = (category === 'all' || card.dataset.category === category) ? 'block' : 'none';
    });
}

// ===== LOAD ACTIVITY LOG =====
async function loadActivityLog() {
    const log = document.getElementById('activityLog');
    
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/activity`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (!response.ok) throw new Error('Failed to load activity');
        
        const activities = await response.json();
        recentActivity = activities || [];
        
        if (recentActivity.length === 0) {
            log.innerHTML = `
                <div class="log-header">
                    <span class="chart-title">Recent Activity</span>
                    <span style="color: var(--text-muted); font-size: 0.75rem;">Live</span>
                </div>
                <div style="padding: 30px; text-align: center; color: var(--text-muted);">
                    <i class="fas fa-history fa-2x" style="margin-bottom: 10px; opacity: 0.5;"></i>
                    <p>No recent activity</p>
                </div>
            `;
            return;
        }
        
        log.innerHTML = `
            <div class="log-header">
                <span class="chart-title">Recent Activity</span>
                <span style="color: var(--text-muted); font-size: 0.75rem;">Live</span>
            </div>
            ${recentActivity.map(a => `
                <div class="log-entry">
                    <div class="log-icon"><i class="fas ${a.icon || 'fa-info-circle'}"></i></div>
                    <div class="log-content">
                        <div class="log-title">${a.title || a.message || 'Activity'}</div>
                        <div class="log-time">${a.time || a.created_at || 'Just now'}</div>
                    </div>
                </div>
            `).join('')}
        `;
    } catch (error) {
        console.error('Error loading activity:', error);
        log.innerHTML = `
            <div class="log-header">
                <span class="chart-title">Recent Activity</span>
                <span style="color: var(--text-muted); font-size: 0.75rem;">Live</span>
            </div>
            <div style="padding: 30px; text-align: center; color: var(--text-muted);">
                <i class="fas fa-exclamation-circle fa-2x" style="margin-bottom: 10px; opacity: 0.5;"></i>
                <p>Unable to load activity</p>
                <button class="btn-primary" onclick="loadActivityLog()" style="margin-top: 10px; padding: 8px 16px; font-size: 0.8rem;">Retry</button>
            </div>
        `;
    }
}

// ===== MODAL FUNCTIONS =====
function showConnectModal() {
    document.getElementById('connectModal').classList.add('active');
}

function closeModal() {
    document.getElementById('connectModal').classList.remove('active');
    selectedPlatform = null;
    document.querySelectorAll('.platform-option').forEach(opt => opt.classList.remove('selected'));
    document.getElementById('accountName').value = '';
    document.getElementById('apiKey').value = '';
    document.getElementById('additionalFields').innerHTML = '';
    document.getElementById('additionalFields').style.display = 'none';
}

function selectPlatform(platformId) {
    document.querySelectorAll('.platform-option').forEach(opt => opt.classList.remove('selected'));
    event.target.closest('.platform-option').classList.add('selected');
    selectedPlatform = platformId;
    
    // Show additional fields if needed
    const validation = platformValidation[platformId];
    if (validation && validation.additionalFields.length > 0) {
        let html = '';
        validation.additionalFields.forEach(field => {
            const fieldName = field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
            html += `
                <div class="form-group">
                    <label>${fieldName}</label>
                    <input type="text" id="${field}" class="form-control" placeholder="Enter ${fieldName}">
                </div>
            `;
        });
        document.getElementById('additionalFields').innerHTML = html;
        document.getElementById('additionalFields').style.display = 'block';
    } else {
        document.getElementById('additionalFields').innerHTML = '';
        document.getElementById('additionalFields').style.display = 'none';
    }
}

// ===== TOAST NOTIFICATIONS =====
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.style.background = type === 'success' ? '#059669' : type === 'info' ? '#2563eb' : '#dc2626';
    toast.style.color = 'white';
    toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'info' ? 'fa-info-circle' : 'fa-exclamation-circle'}"></i> ${message}`;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s reverse';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ===== RENDER FEATURES =====
function renderFeatures() {
    const featuresGrid = document.getElementById('featuresGrid');
    
    featuresGrid.innerHTML = `
        <!-- E-Commerce (3) -->
        <div class="feature-card" data-category="ecommerce">
            <div class="feature-icon" style="background: linear-gradient(135deg, #7AB55C, #2E7D32);">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="feature-header">
                <h3>Inventory Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Real-time inventory tracking across all sales channels. Auto-reorder when stock is low, sync across platforms, prevent overselling.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">99.9%</div><div class="stat-label">Accuracy</div></div>
                <div class="stat"><div class="stat-value">5min</div><div class="stat-label">Sync</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Monitoring</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="runInventoryCheck()">Check Stock</button>
                <button class="btn-outline" onclick="configureFeature('inventory')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="ecommerce">
            <div class="feature-icon" style="background: linear-gradient(135deg, #FF6B6B, #C44545);">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="feature-header">
                <h3>Cart Recovery</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Automated email/SMS sequences for abandoned carts. AI-optimized timing and discounts to maximize conversion rates.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">+32%</div><div class="stat-label">Recovery</div></div>
                <div class="stat"><div class="stat-value">2.4hrs</div><div class="stat-label">Response</div></div>
                <div class="stat"><div class="stat-value">45%</div><div class="stat-label">Open Rate</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="recoverCarts()">Run Recovery</button>
                <button class="btn-outline" onclick="configureFeature('cart')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="ecommerce">
            <div class="feature-icon" style="background: linear-gradient(135deg, #F39C12, #E67E22);">
                <i class="fas fa-tags"></i>
            </div>
            <div class="feature-header">
                <h3>Price Intelligence</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Real-time competitor price tracking. AI suggests optimal pricing to maximize margins while staying competitive.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">1.2M</div><div class="stat-label">Products</div></div>
                <div class="stat"><div class="stat-value">15min</div><div class="stat-label">Updates</div></div>
                <div class="stat"><div class="stat-value">245</div><div class="stat-label">Competitors</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="scanPrices()">Scan Now</button>
                <button class="btn-outline" onclick="viewPriceAlerts()"><i class="fas fa-bell"></i></button>
            </div>
        </div>

        <!-- CRM & Sales (3) -->
        <div class="feature-card" data-category="crm">
            <div class="feature-icon" style="background: linear-gradient(135deg, #3498DB, #2980B9);">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="feature-header">
                <h3>AI Lead Scoring</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Automatically score leads based on behavior, engagement, and demographics. Focus sales team on hot leads first.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">93%</div><div class="stat-label">Accuracy</div></div>
                <div class="stat"><div class="stat-value">2.5x</div><div class="stat-label">Conversion</div></div>
                <div class="stat"><div class="stat-value">Real-time</div><div class="stat-label">Scoring</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="scoreLeads()">Score Now</button>
                <button class="btn-outline" onclick="configureFeature('scoring')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="crm">
            <div class="feature-icon" style="background: linear-gradient(135deg, #9B59B6, #8E44AD);">
                <i class="fas fa-envelope-open-text"></i>
            </div>
            <div class="feature-header">
                <h3>Smart Email Sequences</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">AI-powered email drip campaigns that adapt based on recipient behavior. Personalized timing and content.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">+47%</div><div class="stat-label">Open Rate</div></div>
                <div class="stat"><div class="stat-value">32%</div><div class="stat-label">CTR</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Sending</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="createSequence()">Create</button>
                <button class="btn-outline" onclick="configureFeature('email')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="crm">
            <div class="feature-icon" style="background: linear-gradient(135deg, #1ABC9C, #16A085);">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="feature-header">
                <h3>Task Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-create tasks from emails, calls, and meetings. Assign to team members based on workload and skills.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">1,247</div><div class="stat-label">Tasks</div></div>
                <div class="stat"><div class="stat-value">89%</div><div class="stat-label">Auto-assign</div></div>
                <div class="stat"><div class="stat-value">2.3s</div><div class="stat-label">Processing</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="processTasks()">Process</button>
                <button class="btn-outline" onclick="configureFeature('tasks')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <!-- Marketing (3) -->
        <div class="feature-card" data-category="marketing">
            <div class="feature-icon" style="background: linear-gradient(135deg, #E1306C, #C13584);">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="feature-header">
                <h3>Smart Social Scheduler</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">AI-optimized posting times across all platforms. Auto-generate captions and hashtags using computer vision.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">+156%</div><div class="stat-label">Engagement</div></div>
                <div class="stat"><div class="stat-value">12</div><div class="stat-label">Platforms</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Posting</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="schedulePosts()">Schedule</button>
                <button class="btn-outline" onclick="configureFeature('social')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="marketing">
            <div class="feature-icon" style="background: linear-gradient(135deg, #4285F4, #0F9D58);">
                <i class="fas fa-ad"></i>
            </div>
            <div class="feature-header">
                <h3>Ad Intelligence</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Real-time monitoring of all ad campaigns. AI suggests budget allocation and audience optimization.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">-32%</div><div class="stat-label">CPA</div></div>
                <div class="stat"><div class="stat-value">+45%</div><div class="stat-label">ROAS</div></div>
                <div class="stat"><div class="stat-value">5min</div><div class="stat-label">Updates</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="analyzeAds()">Analyze</button>
                <button class="btn-outline" onclick="configureFeature('ads')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="marketing">
            <div class="feature-icon" style="background: linear-gradient(135deg, #FF9900, #F57C00);">
                <i class="fas fa-search"></i>
            </div>
            <div class="feature-header">
                <h3>SEO Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Track keyword rankings, monitor backlinks, get alerts for ranking drops. AI suggests content improvements.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">10K+</div><div class="stat-label">Keywords</div></div>
                <div class="stat"><div class="stat-value">Daily</div><div class="stat-label">Checks</div></div>
                <div class="stat"><div class="stat-value">89%</div><div class="stat-label">Accuracy</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="checkSEO()">Check SEO</button>
                <button class="btn-outline" onclick="configureFeature('seo')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <!-- Customer Support (3) -->
        <div class="feature-card" data-category="support">
            <div class="feature-icon" style="background: linear-gradient(135deg, #00BCD4, #0097A7);">
                <i class="fas fa-ticket-alt"></i>
            </div>
            <div class="feature-header">
                <h3>Smart Ticket Routing</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">AI analyzes ticket content and routes to the right team member based on skills and availability.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">-67%</div><div class="stat-label">Response Time</div></div>
                <div class="stat"><div class="stat-value">95%</div><div class="stat-label">Accuracy</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Routing</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="routeTickets()">Route Now</button>
                <button class="btn-outline" onclick="configureFeature('routing')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="support">
            <div class="feature-icon" style="background: linear-gradient(135deg, #4CAF50, #388E3C);">
                <i class="fas fa-reply-all"></i>
            </div>
            <div class="feature-header">
                <h3>AI Auto-Responder</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Instant AI-generated responses for common queries. Learn from past conversations to improve.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">78%</div><div class="stat-label">Auto-resolve</div></div>
                <div class="stat"><div class="stat-value">2.3s</div><div class="stat-label">Response</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Support</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="enableAutoReply()">Enable</button>
                <button class="btn-outline" onclick="configureFeature('autoreply')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="support">
            <div class="feature-icon" style="background: linear-gradient(135deg, #FF9800, #F57C00);">
                <i class="fas fa-smile"></i>
            </div>
            <div class="feature-header">
                <h3>CSAT Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-send satisfaction surveys after support interactions. AI analyzes feedback and flags issues.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">4.8/5</div><div class="stat-label">Avg Rating</div></div>
                <div class="stat"><div class="stat-value">89%</div><div class="stat-label">Response</div></div>
                <div class="stat"><div class="stat-value">Real-time</div><div class="stat-label">Alerts</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="sendSurveys()">Send Now</button>
                <button class="btn-outline" onclick="configureFeature('surveys')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <!-- Finance (3) -->
        <div class="feature-card" data-category="finance">
            <div class="feature-icon" style="background: linear-gradient(135deg, #2ECC71, #27AE60);">
                <i class="fas fa-file-invoice"></i>
            </div>
            <div class="feature-header">
                <h3>Invoice Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-generate and send invoices. Track payments, send reminders, and reconcile with bank accounts.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">1,247</div><div class="stat-label">Invoices</div></div>
                <div class="stat"><div class="stat-value">98%</div><div class="stat-label">On-time</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Processing</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="processInvoices()">Process</button>
                <button class="btn-outline" onclick="configureFeature('invoices')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="finance">
            <div class="feature-icon" style="background: linear-gradient(135deg, #E74C3C, #C0392B);">
                <i class="fas fa-receipt"></i>
            </div>
            <div class="feature-header">
                <h3>Expense Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-categorize expenses from receipts using computer vision. Flag unusual spending patterns.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">5K+</div><div class="stat-label">Receipts</div></div>
                <div class="stat"><div class="stat-value">97%</div><div class="stat-label">Accuracy</div></div>
                <div class="stat"><div class="stat-value">Real-time</div><div class="stat-label">Tracking</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="scanExpenses()">Scan Receipts</button>
                <button class="btn-outline" onclick="configureFeature('expenses')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="finance">
            <div class="feature-icon" style="background: linear-gradient(135deg, #3498DB, #2980B9);">
                <i class="fas fa-users-cog"></i>
            </div>
            <div class="feature-header">
                <h3>Payroll Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-calculate hours, taxes, and deductions. Generate payslips and process direct deposits.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">247</div><div class="stat-label">Employees</div></div>
                <div class="stat"><div class="stat-value">99.9%</div><div class="stat-label">Accuracy</div></div>
                <div class="stat"><div class="stat-value">Auto</div><div class="stat-label">Processing</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="processPayroll()">Run Payroll</button>
                <button class="btn-outline" onclick="configureFeature('payroll')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <!-- HR (3) -->
        <div class="feature-card" data-category="hr">
            <div class="feature-icon" style="background: linear-gradient(135deg, #9B59B6, #8E44AD);">
                <i class="fas fa-umbrella-beach"></i>
            </div>
            <div class="feature-header">
                <h3>Leave Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-approve leave requests based on policy and team capacity. Sync with calendar and payroll.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">2.3s</div><div class="stat-label">Processing</div></div>
                <div class="stat"><div class="stat-value">100%</div><div class="stat-label">Policy</div></div>
                <div class="stat"><div class="stat-label">Compliance</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="processLeave()">Process</button>
                <button class="btn-outline" onclick="configureFeature('leave')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="hr">
            <div class="feature-icon" style="background: linear-gradient(135deg, #1ABC9C, #16A085);">
                <i class="fas fa-user-plus"></i>
            </div>
            <div class="feature-header">
                <h3>Employee Onboarding</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Automated onboarding checklists. Send welcome emails, create accounts, schedule training.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">-67%</div><div class="stat-label">Time</div></div>
                <div class="stat"><div class="stat-value">100%</div><div class="stat-label">Tasks</div></div>
                <div class="stat"><div class="stat-value">Auto</div><div class="stat-label">Setup</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="startOnboarding()">Start</button>
                <button class="btn-outline" onclick="configureFeature('onboarding')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="hr">
            <div class="feature-icon" style="background: linear-gradient(135deg, #F39C12, #E67E22);">
                <i class="fas fa-star"></i>
            </div>
            <div class="feature-header">
                <h3>Review Automation</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Schedule and track performance reviews. AI analyzes feedback and suggests development plans.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">247</div><div class="stat-label">Employees</div></div>
                <div class="stat"><div class="stat-value">Quarterly</div><div class="stat-label">Reviews</div></div>
                <div class="stat"><div class="stat-value">AI</div><div class="stat-label">Insights</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="scheduleReviews()">Schedule</button>
                <button class="btn-outline" onclick="configureFeature('reviews')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <!-- Project Management (3) -->
        <div class="feature-card" data-category="project">
            <div class="feature-icon" style="background: linear-gradient(135deg, #3498DB, #2980B9);">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="feature-header">
                <h3>Smart Assignment</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">AI assigns tasks based on skills, workload, and past performance. Optimizes team productivity.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">+45%</div><div class="stat-label">Efficiency</div></div>
                <div class="stat"><div class="stat-value">Real-time</div><div class="stat-label">Balancing</div></div>
                <div class="stat"><div class="stat-value">Auto</div><div class="stat-label">Assignment</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="assignTasks()">Assign</button>
                <button class="btn-outline" onclick="configureFeature('assignment')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="project">
            <div class="feature-icon" style="background: linear-gradient(135deg, #E74C3C, #C0392B);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="feature-header">
                <h3>Deadline Monitor</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Track project deadlines, send reminders, predict delays based on progress. Auto-reschedule when needed.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">-89%</div><div class="stat-label">Missed</div></div>
                <div class="stat"><div class="stat-value">24/7</div><div class="stat-label">Tracking</div></div>
                <div class="stat"><div class="stat-value">AI</div><div class="stat-label">Predictions</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="checkDeadlines()">Check</button>
                <button class="btn-outline" onclick="configureFeature('deadlines')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="project">
            <div class="feature-icon" style="background: linear-gradient(135deg, #2ECC71, #27AE60);">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="feature-header">
                <h3>Auto Reports</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Auto-generate project status reports. AI summarizes progress, risks, and next steps.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">Daily</div><div class="stat-label">Reports</div></div>
                <div class="stat"><div class="stat-value">5min</div><div class="stat-label">Generation</div></div>
                <div class="stat"><div class="stat-value">Auto-send</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="generateReport()">Generate</button>
                <button class="btn-outline" onclick="configureFeature('reports')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <!-- Social Media (3) -->
        <div class="feature-card" data-category="social">
            <div class="feature-icon" style="background: linear-gradient(135deg, #E1306C, #C13584);">
                <i class="fas fa-pen-fancy"></i>
            </div>
            <div class="feature-header">
                <h3>AI Content Creator</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Generate social media posts, captions, and hashtags using AI. Optimized for each platform.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">1K+</div><div class="stat-label">Posts</div></div>
                <div class="stat"><div class="stat-value">2.3s</div><div class="stat-label">Generation</div></div>
                <div class="stat"><div class="stat-value">12</div><div class="stat-label">Platforms</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="createContent()">Create</button>
                <button class="btn-outline" onclick="configureFeature('content')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="social">
            <div class="feature-icon" style="background: linear-gradient(135deg, #4267B2, #38548A);">
                <i class="fas fa-heart"></i>
            </div>
            <div class="feature-header">
                <h3>Engagement Monitor</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Track likes, comments, shares across platforms. AI identifies trending content and suggests engagement.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">2.3M</div><div class="stat-label">Engagements</div></div>
                <div class="stat"><div class="stat-value">Real-time</div><div class="stat-label">Tracking</div></div>
                <div class="stat"><div class="stat-value">AI</div><div class="stat-label">Insights</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="trackEngagement()">Track</button>
                <button class="btn-outline" onclick="configureFeature('engagement')"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="feature-card" data-category="social">
            <div class="feature-icon" style="background: linear-gradient(135deg, #6441A5, #2A0845);">
                <i class="fas fa-users"></i>
            </div>
            <div class="feature-header">
                <h3>Influencer Tracker</h3>
                <span class="feature-badge">AI-POWERED</span>
            </div>
            <p class="feature-description">Monitor influencer mentions and collaborations. AI scores influencer relevance and reach.</p>
            <div class="feature-stats">
                <div class="stat"><div class="stat-value">10K+</div><div class="stat-label">Influencers</div></div>
                <div class="stat"><div class="stat-value">Daily</div><div class="stat-label">Updates</div></div>
                <div class="stat"><div class="stat-value">AI</div><div class="stat-label">Scoring</div></div>
            </div>
            <div class="feature-action">
                <button class="btn-primary" onclick="trackInfluencers()">Track</button>
                <button class="btn-outline" onclick="configureFeature('influencers')"><i class="fas fa-cog"></i></button>
            </div>
        </div>
    `;
}

// ===== AUTOMATION FUNCTIONS =====
async function runInventoryCheck() { 
    showToast('ðŸ“¦ Checking inventory across all connected platforms...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/inventory/check`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`ðŸ“¦ Found ${data.lowStock || 0} low stock items`, 'success');
            await loadActivityLog();
        }
    } catch (error) {
        showToast('ðŸ“¦ Inventory check started', 'info');
    }
}

async function recoverCarts() { 
    showToast('ðŸ›’ Starting cart recovery...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/carts/recover`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`ðŸ›’ Recovered ${data.count || 0} carts`, 'success');
            await loadActivityLog();
        }
    } catch (error) {
        showToast('ðŸ›’ Cart recovery started', 'info');
    }
}

async function scoreLeads() { 
    showToast('ðŸ“Š Scoring leads...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/leads/score`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`ðŸ“Š Found ${data.hotLeads || 0} hot leads`, 'success');
            await loadActivityLog();
        }
    } catch (error) {
        showToast('ðŸ“Š Lead scoring started', 'info');
    }
}

async function createSequence() { 
    showToast('ðŸ“§ Creating email sequence...', 'info');
    setTimeout(() => showToast('ðŸ“§ Email sequence created', 'success'), 1500);
}

async function processTasks() { 
    showToast('âœ… Processing tasks...', 'info');
    setTimeout(() => showToast('âœ… Tasks processed', 'success'), 1500);
}

async function schedulePosts() { 
    showToast('ðŸ“… Scheduling posts...', 'info');
    setTimeout(() => showToast('ðŸ“… Posts scheduled', 'success'), 1500);
}

async function analyzeAds() { 
    showToast('ðŸ“ˆ Analyzing ads...', 'info');
    setTimeout(() => showToast('ðŸ“ˆ Analysis complete', 'success'), 2000);
}

async function checkSEO() { 
    showToast('ðŸ” Checking SEO...', 'info');
    setTimeout(() => showToast('ðŸ” SEO check complete', 'success'), 2000);
}

async function routeTickets() { 
    showToast('ðŸŽ« Routing tickets...', 'info');
    setTimeout(() => showToast('ðŸŽ« Tickets routed', 'success'), 1500);
}

async function enableAutoReply() { 
    showToast('ðŸ¤– Enabling auto-reply...', 'info');
    setTimeout(() => showToast('ðŸ¤– Auto-reply enabled', 'success'), 1500);
}

async function sendSurveys() { 
    showToast('ðŸ“‹ Sending surveys...', 'info');
    setTimeout(() => showToast('ðŸ“‹ Surveys sent', 'success'), 1500);
}

async function processInvoices() { 
    showToast('ðŸ’° Processing invoices...', 'info');
    setTimeout(() => showToast('ðŸ’° Invoices processed', 'success'), 2000);
}

async function scanExpenses() { 
    showToast('ðŸ§¾ Scanning expenses...', 'info');
    setTimeout(() => showToast('ðŸ§¾ Expenses scanned', 'success'), 2000);
}

async function processPayroll() { 
    showToast('ðŸ’µ Processing payroll...', 'info');
    setTimeout(() => showToast('ðŸ’µ Payroll processed', 'success'), 2000);
}

async function processLeave() { 
    showToast('ðŸ–ï¸ Processing leave...', 'info');
    setTimeout(() => showToast('ðŸ–ï¸ Leave processed', 'success'), 1500);
}

async function startOnboarding() { 
    showToast('ðŸ‘‹ Starting onboarding...', 'info');
    setTimeout(() => showToast('ðŸ‘‹ Onboarding started', 'success'), 1500);
}

async function scheduleReviews() { 
    showToast('ðŸ“‹ Scheduling reviews...', 'info');
    setTimeout(() => showToast('ðŸ“‹ Reviews scheduled', 'success'), 1500);
}

async function assignTasks() { 
    showToast('âœ… Assigning tasks...', 'info');
    setTimeout(() => showToast('âœ… Tasks assigned', 'success'), 1500);
}

async function checkDeadlines() { 
    showToast('â° Checking deadlines...', 'info');
    setTimeout(() => showToast('â° Deadlines checked', 'success'), 1500);
}

async function generateReport() { 
    showToast('ðŸ“Š Generating report...', 'info');
    setTimeout(() => showToast('ðŸ“Š Report generated', 'success'), 2000);
}

async function createContent() { 
    showToast('âœï¸ Creating content...', 'info');
    setTimeout(() => showToast('âœï¸ Content created', 'success'), 2000);
}

async function trackEngagement() { 
    showToast('â¤ï¸ Tracking engagement...', 'info');
    setTimeout(() => showToast('â¤ï¸ Engagement tracked', 'success'), 1500);
}

async function trackInfluencers() { 
    showToast('ðŸŒŸ Tracking influencers...', 'info');
    setTimeout(() => showToast('ðŸŒŸ Influencers tracked', 'success'), 1500);
}

async function analyzeWithVision() { 
    showToast('ðŸ” Vision analysis started...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/vision/analyze`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`ðŸ” Analyzed ${data.frames || 0} frames`, 'success');
            await loadStats();
        }
    } catch (error) {
        showToast('ðŸ” Vision analysis unavailable', 'error');
    }
}

async function rotateFingerprint() { 
    showToast('ðŸ›¡ï¸ Rotating fingerprint...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/anti-detection/rotate`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) showToast('ðŸ›¡ï¸ Fingerprint rotated', 'success');
    } catch (error) {
        showToast('ðŸ›¡ï¸ Rotation failed', 'error');
    }
}

async function showProxyStats() { 
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/proxy-stats`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const stats = await response.json();
            showToast(`ðŸ“Š ${stats.proxies || 0} active proxies`, 'info');
        }
    } catch (error) {
        showToast('ðŸ“Š Proxy stats unavailable', 'error');
    }
}

async function enrichLeads() { 
    showToast('âš¡ Enriching leads...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/leads/enrich`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`âš¡ Found ${data.discovered || 0} insights`, 'success');
            await loadStats();
        }
    } catch (error) {
        showToast('âš¡ Enrichment started', 'info');
    }
}

function viewLeadDatabase() { 
    showToast(`ðŸ“Š ${totalLeads} total leads`, 'info'); 
}

async function spawnInstance() { 
    showToast('ðŸ“± Spawning instance...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/mobile/spawn`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`ðŸ“± ${data.instances || 0} instances spawned`, 'success');
            await loadStats();
        }
    } catch (error) {
        showToast('ðŸ“± Spawn started', 'info');
    }
}

function manageInstances() { 
    showToast('â˜ï¸ Cloud Console', 'info'); 
}

async function scanPrices() { 
    showToast('ðŸ’° Scanning prices...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/prices/scan`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) showToast('ðŸ’° Scan complete', 'success');
    } catch (error) {
        showToast('ðŸ’° Scan started', 'info');
    }
}

function viewPriceAlerts() { 
    showToast('ðŸ”” Checking alerts...', 'info'); 
}

async function deployAgent() { 
    showToast('ðŸ¤– Deploying agent...', 'info');
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/agents/deploy`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` }
        });
        if (response.ok) {
            const data = await response.json();
            showToast(`ðŸ¤– ${data.agentType || 'Agent'} deployed`, 'success');
            await loadStats();
        }
    } catch (error) {
        showToast('ðŸ¤– Deployment started', 'info');
    }
    setTimeout(loadActivityLog, 2000);
}

function viewAgents() { 
    showToast(`ðŸ¤– ${activeAgents} active agents`, 'info'); 
}

function configureAccount(platform) { 
    showToast(`âš™ï¸ Configuring ${platform}...`, 'info'); 
}

function configureFeature(feature) { 
    showToast(`âš™ï¸ Configuring ${feature}...`, 'info'); 
}

async function connectAccount() {
    if (!selectedPlatform) {
        showToast('Please select a platform', 'error');
        return;
    }
    
    const accountName = document.getElementById('accountName').value;
    const apiKey = document.getElementById('apiKey').value;
    
    if (!accountName || !apiKey) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    // Validate API key format
    const validation = platformValidation[selectedPlatform];
    if (validation) {
        if (!validation.apiKeyFormat.test(apiKey)) {
            showToast(`Invalid API key format for ${selectedPlatform}`, 'error');
            return;
        }
        
        // Collect additional fields
        const additionalData = {};
        if (validation.additionalFields.length > 0) {
            let allValid = true;
            validation.additionalFields.forEach(field => {
                const value = document.getElementById(field)?.value;
                if (!value) {
                    showToast(`Please enter ${field}`, 'error');
                    allValid = false;
                }
                additionalData[field] = value;
            });
            if (!allValid) return;
        }
        
        // Validate platform-specific requirements
        if (!validation.validate({ apiKey, ...additionalData })) {
            showToast(`Invalid credentials for ${selectedPlatform}`, 'error');
            return;
        }
    }
    
    const connectBtn = event.target;
    const originalText = connectBtn.innerHTML;
    connectBtn.innerHTML = '<div class="loading-spinner"></div> Connecting...';
    connectBtn.disabled = true;
    
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`${API_BASE}/automations/connect`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                platform: selectedPlatform,
                accountName: accountName,
                apiKey: apiKey,
                ...(validation?.additionalFields.reduce((acc, field) => {
                    acc[field] = document.getElementById(field)?.value;
                    return acc;
                }, {}) || {})
            })
        });
        
        if (response.ok) {
            showToast('âœ… Account connected successfully!', 'success');
            closeModal();
            await loadConnectedAccounts();
            await loadActivityLog();
        } else {
            const error = await response.json();
            showToast(error.error || 'Failed to connect account', 'error');
        }
    } catch (error) {
        showToast('Connection service unavailable', 'error');
    } finally {
        connectBtn.innerHTML = originalText;
        connectBtn.disabled = false;
    }
}

// Make all functions globally available
window.filterFeatures = filterFeatures;
window.showConnectModal = showConnectModal;
window.closeModal = closeModal;
window.connectAccount = connectAccount;
window.configureAccount = configureAccount;
window.analyzeWithVision = analyzeWithVision;
window.rotateFingerprint = rotateFingerprint;
window.showProxyStats = showProxyStats;
window.enrichLeads = enrichLeads;
window.viewLeadDatabase = viewLeadDatabase;
window.spawnInstance = spawnInstance;
window.manageInstances = manageInstances;
window.scanPrices = scanPrices;
window.viewPriceAlerts = viewPriceAlerts;
window.deployAgent = deployAgent;
window.viewAgents = viewAgents;
window.configureFeature = configureFeature;
window.selectPlatform = selectPlatform;
window.searchPlatforms = searchPlatforms;
window.runInventoryCheck = runInventoryCheck;
window.recoverCarts = recoverCarts;
window.scoreLeads = scoreLeads;
window.createSequence = createSequence;
window.processTasks = processTasks;
window.schedulePosts = schedulePosts;
window.analyzeAds = analyzeAds;
window.checkSEO = checkSEO;
window.routeTickets = routeTickets;
window.enableAutoReply = enableAutoReply;
window.sendSurveys = sendSurveys;
window.processInvoices = processInvoices;
window.scanExpenses = scanExpenses;
window.processPayroll = processPayroll;
window.processLeave = processLeave;
window.startOnboarding = startOnboarding;
window.scheduleReviews = scheduleReviews;
window.assignTasks = assignTasks;
window.checkDeadlines = checkDeadlines;
window.generateReport = generateReport;
window.createContent = createContent;
window.trackEngagement = trackEngagement;
window.trackInfluencers = trackInfluencers;
</script>
</body>
</html>
