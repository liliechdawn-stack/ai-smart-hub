<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Business Hub | AI Intelligence Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Load scripts in correct order -->
    <script src="js/config.js"></script>
    <script src="js/master-fix.js"></script>
    <script src="js/fix-all-html.js"></script>
    
    <style>
        /* ========================================
           PREMIUM DESIGN TOKENS
           ========================================
        */
        :root {
            --primary: #d4af37;
            --primary-light: #f5e7b2;
            --primary-dark: #b8962e;
            --primary-gradient: linear-gradient(135deg, #d4af37 0%, #f1c40f 100%);
            --primary-glow: 0 0 20px rgba(212, 175, 55, 0.3);
            
            --dark: #1a1a1a;
            --dark-accent: #2d2d2d;
            --dark-card: #2a2a2a;
            --light: #f8f9fa;
            --light-gray: #e9ecef;
            
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --info: #3b82f6;
            --info-light: #dbeafe;
            
            --border-color: rgba(0,0,0,0.08);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.12);
            --shadow-gold: 0 10px 30px rgba(212, 175, 55, 0.2);
            
            --card-radius: 20px;
            --button-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f6f9fc 0%, #f1f5f9 100%);
            color: var(--dark); 
            line-height: 1.6; 
            min-height: 100vh;
        }

        /* ========================================
           PREMIUM NAVIGATION
           ========================================
        */
        nav {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            border-bottom: 1px solid rgba(212,175,55,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }
        
        .nav-container { 
            max-width: 1400px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 30px; 
        }
        
        .nav-logo { 
            font-weight: 800; 
            font-size: 1.4rem; 
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            letter-spacing: -0.5px;
        }
        
        .nav-logo i {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8rem;
        }
        
        .nav-links { 
            display: flex; 
            gap: 30px; 
            align-items: center; 
        }
        
        .nav-links a { 
            text-decoration: none; 
            color: #4b5563; 
            font-size: 0.95rem; 
            font-weight: 600; 
            transition: var(--transition); 
            position: relative;
            padding: 5px 0;
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-gradient);
            transition: var(--transition);
        }
        
        .nav-links a:hover {
            color: var(--primary-dark);
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        .nav-links a.active-nav { 
            color: var(--primary-dark); 
            font-weight: 700;
        }
        
        .nav-links a.active-nav::after {
            width: 100%;
        }
        
        .back-btn { 
            background: var(--dark); 
            color: white !important; 
            padding: 10px 22px !important; 
            border-radius: 30px; 
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        
        .back-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .back-btn::after {
            display: none;
        }

        /* ========================================
           PREMIUM HERO SECTION
           ========================================
        */
        .hero { 
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 80px 30px; 
            text-align: center; 
            border-bottom: 1px solid rgba(212,175,55,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(212,175,55,0.03) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }
        
        .hero h1 { 
            font-size: 3.2rem; 
            margin-bottom: 15px; 
            letter-spacing: -1px; 
            font-weight: 800;
            background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero p { 
            color: #6b7280; 
            max-width: 650px; 
            margin: 0 auto; 
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .plan-indicator {
            margin-top: 25px;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: white;
            padding: 8px 20px;
            border-radius: 40px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(212,175,55,0.2);
        }
        
        .plan-indicator span {
            font-weight: 600;
            color: #4b5563;
        }
        
        #currentPlanName {
            background: var(--primary-gradient);
            color: white !important;
            padding: 6px 20px;
            border-radius: 30px;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-gold);
        }

        /* ========================================
           PREMIUM SECTION HEADERS
           ========================================
        */
        .section-header { 
            max-width: 1400px; 
            margin: 60px auto 30px; 
            padding: 0 30px;
            display: flex; 
            align-items: center; 
            gap: 20px;
        }
        
        .section-header h2 { 
            font-size: 2rem; 
            font-weight: 700;
            background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px; 
            white-space: nowrap;
        }
        
        .section-line { 
            flex-grow: 1; 
            height: 2px; 
            background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);
            border-radius: 2px;
        }

        /* ========================================
           PREMIUM CARD LAYOUT
           ========================================
        */
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 30px 80px; 
        }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 30px; 
        }

        .tool-card {
            background: white;
            border-radius: var(--card-radius);
            padding: 35px;
            border: 1px solid rgba(212,175,55,0.1);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
        }
        
        .tool-card:hover:not(.locked-card) { 
            transform: translateY(-5px); 
            border-color: var(--primary);
            box-shadow: var(--shadow-lg), var(--shadow-gold);
        }

        .wide-card { 
            grid-column: 1 / -1; 
            display: flex; 
            flex-direction: row; 
            gap: 50px; 
            align-items: flex-start; 
            background: linear-gradient(135deg, white 0%, #fafafa 100%);
        }
        
        @media (max-width: 900px) { 
            .wide-card { flex-direction: column; } 
        }

        .icon-box {
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            color: var(--primary-dark);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(212,175,55,0.15);
        }

        h3 { 
            margin-bottom: 15px; 
            font-size: 1.4rem; 
            font-weight: 700;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tool-description { 
            color: #6b7280; 
            font-size: 0.95rem; 
            margin-bottom: 25px; 
            line-height: 1.7;
        }

        /* ========================================
           PREMIUM FORM ELEMENTS
           ========================================
        */
        .input-group { margin-bottom: 25px; }
        
        label { 
            display: block; 
            font-size: 0.8rem; 
            font-weight: 700; 
            margin-bottom: 10px; 
            color: #4b5563; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, select, textarea { 
            width: 100%; 
            padding: 16px; 
            border: 2px solid #e5e7eb;
            border-radius: 14px; 
            font-family: inherit; 
            font-size: 0.95rem; 
            background: #f9fafb;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }
        
        textarea { 
            resize: vertical; 
            min-height: 120px; 
        }

        /* ========================================
           PREMIUM BUTTON STYLES
           ========================================
        */
        .btn-save {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 16px 25px;
            border-radius: 14px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-save::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .btn-save:hover:not(:disabled) {
            background: linear-gradient(135deg, #b8962e 0%, #d4af37 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }
        
        .btn-save:hover::before {
            left: 100%;
        }
        
        .btn-save:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
            transform: none;
        }

        .btn-live-status {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: white !important;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4) !important;
            animation: pulse-live 2s infinite;
        }
        
        .btn-inactive {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%) !important;
            color: white !important;
        }

        @keyframes pulse-live {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        /* ========================================
           PREMIUM LOCK SYSTEM
           ========================================
        */
        .locked-card { 
            position: relative; 
            overflow: hidden; 
            border-color: #e5e7eb !important; 
            opacity: 0.9;
        }
        
        .lock-overlay {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(8px);
            z-index: 10; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            padding: 30px;
            border-radius: var(--card-radius);
        }
        
        .lock-overlay span { 
            font-size: 3rem; 
            margin-bottom: 15px; 
        }
        
        .lock-overlay p { 
            font-weight: 700; 
            color: #1f2937; 
            margin-bottom: 20px; 
            font-size: 1.1rem; 
        }
        
        .preview-box {
            background: white; 
            padding: 20px; 
            border-radius: 16px; 
            box-shadow: var(--shadow-md); 
            margin-bottom: 25px; 
            font-size: 0.9rem; 
            text-align: left; 
            width: 100%; 
            max-width: 300px;
            border: 1px solid #f3f4f6;
            line-height: 1.7;
        }

        .upgrade-btn { 
            background: var(--primary-gradient); 
            color: white; 
            border: none; 
            padding: 14px 35px; 
            border-radius: 40px; 
            cursor: pointer; 
            font-weight: 700; 
            font-size: 1rem;
            transition: var(--transition);
            box-shadow: var(--shadow-gold);
            width: auto;
            min-width: 200px;
        }
        
        .upgrade-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        /* ========================================
           PREMIUM TOGGLES
           ========================================
        */
        .switch-group { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #f9fafb; 
            padding: 18px 20px; 
            border-radius: 14px; 
            margin-bottom: 20px; 
            border: 1px solid #e5e7eb;
        }
        
        .switch { 
            position: relative; 
            display: inline-block; 
            width: 52px; 
            height: 28px; 
        }
        
        .switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #d1d5db; 
            transition: .4s; 
            border-radius: 34px; 
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 22px; width: 22px; 
            left: 3px; bottom: 3px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider { 
            background: var(--primary-gradient); 
        }
        
        input:checked + .slider:before { 
            transform: translateX(24px); 
        }

        /* ========================================
           PREMIUM DATA TABLE
           ========================================
        */
        .data-table-container { 
            background: white; 
            border-radius: 18px; 
            border: 1px solid #e5e7eb; 
            overflow: hidden; 
            margin-top: 20px; 
            box-shadow: var(--shadow-sm);
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            text-align: left; 
        }
        
        th { 
            background: #f9fafb; 
            padding: 18px 20px; 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            color: #6b7280; 
            border-bottom: 2px solid #e5e7eb; 
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        td { 
            padding: 18px 20px; 
            font-size: 0.95rem; 
            border-bottom: 1px solid #e5e7eb; 
            color: #1f2937;
        }
        
        .role-tag { 
            padding: 5px 14px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: 700; 
            display: inline-block;
        }
        
        .tag-admin { 
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
            color: #92400e; 
        }
        
        .tag-staff { 
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); 
            color: #065f46; 
        }

        /* ========================================
           PREMIUM STATUS BADGES
           ========================================
        */
        .op-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            color: #10b981;
            font-weight: 700;
            background: #d1fae5;
            padding: 4px 12px;
            border-radius: 30px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .pulse-dot {
            width: 8px;
            height: 8px;
            background-color: #10b981;
            border-radius: 50%;
            display: inline-block;
            animation: pulse-green 2s infinite;
        }

        .status-badge { 
            font-size: 0.7rem; 
            padding: 5px 15px; 
            border-radius: 30px; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            display: inline-block;
        }
        
        .badge-pro { 
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); 
            color: #1e40af; 
        }
        
        .badge-enterprise { 
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); 
            color: #5b21b6; 
        }

        /* ========================================
           PREMIUM BUSINESS INFO CARD
           ========================================
        */
        .business-type-info {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            padding: 25px;
            border-radius: 18px;
            border: 1px solid var(--primary);
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .business-type-info h4 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .business-type-info ul {
            margin: 0;
            padding-left: 20px;
            color: #4b5563;
            font-size: 0.9rem;
            line-height: 2;
        }

        /* ========================================
           PREMIUM FOOTER
           ========================================
        */
        footer { 
            text-align: center; 
            padding: 50px 20px; 
            color: #9ca3af; 
            font-size: 0.95rem; 
            border-top: 1px solid #e5e7eb; 
            background: white;
            margin-top: 40px;
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-container">
        <a href="dashboard.html" class="nav-logo">
            <i class="fas fa-robot"></i>
            AI Smart Hub
        </a>
        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="ai-automations.html">AI Automations</a>
            <a href="#ai-brain-section">AI Brain</a>
            <a href="#org-section">Team</a>
            <a href="customer-insights.html">Customer Insights</a>
            <a href="dashboard.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Exit Center
            </a>
        </div>
    </div>
</nav>

<div class="hero">
    <h1>AI Intelligence Center</h1>
    <p>Your centralized dashboard for configuring high-performance AI tools and knowledge bases.</p>
    <div class="plan-indicator">
        <span>ACCOUNT STATUS</span>
        <span id="currentPlanName">DETECTING...</span>
    </div>
</div>

<div class="container">

    <!-- Business Identity Section -->
    <div class="section-header" id="business-identity-section">
        <h2>üè¢ Business Identity</h2>
        <div class="section-line"></div>
    </div>

    <div class="grid">
        <div class="tool-card wide-card" id="card-business-type">
            <div style="flex: 1;">
                <div class="icon-box">üè¢</div>
                <h3>Business Profile <span class="op-indicator"><span class="pulse-dot"></span> READY</span></h3>
                <p class="tool-description">Define your business type and industry so the AI can represent you accurately to customers.</p>
                
                <div class="input-group">
                    <label><i class="fas fa-store" style="margin-right: 8px; color: var(--primary);"></i> Business Type / Industry</label>
                    <select id="businessType">
                        <option value="">Select your business type...</option>
                        <option value="retail">Retail Store (Clothing, Electronics, etc.)</option>
                        <option value="restaurant">Restaurant / Food Service</option>
                        <option value="salon">Beauty Salon / Spa</option>
                        <option value="consulting">Consulting / Professional Services</option>
                        <option value="healthcare">Healthcare / Medical</option>
                        <option value="fitness">Fitness / Gym</option>
                        <option value="realestate">Real Estate</option>
                        <option value="education">Education / Training</option>
                        <option value="technology">Technology / SaaS</option>
                        <option value="automotive">Automotive / Car Dealership</option>
                        <option value="hotel">Hotel / Hospitality</option>
                        <option value="legal">Legal Services</option>
                        <option value="finance">Financial Services</option>
                        <option value="construction">Construction / Home Services</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-align-left" style="margin-right: 8px; color: var(--primary);"></i> Business Description (Optional)</label>
                    <textarea id="businessDescription" rows="3" placeholder="e.g., We sell premium men's formal wear and accessories, specializing in wedding suits and corporate attire..."></textarea>
                </div>
                
                <button class="btn-save" id="businessTypeBtn" onclick="saveSmartTool('business_type', event)">
                    <i class="fas fa-save"></i> Save Business Identity
                </button>
            </div>
            
            <div style="flex: 0.8; background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); padding: 30px; border-radius: 18px; border: 1px dashed var(--primary);">
                <h3 style="color: #1f2937; margin-bottom: 15px;">Why This Matters</h3>
                <div class="business-type-info">
                    <h4>When customers chat with your widget, the AI will know:</h4>
                    <ul>
                        <li><i class="fas fa-check-circle" style="color: var(--primary); margin-right: 8px;"></i> What industry you're in</li>
                        <li><i class="fas fa-check-circle" style="color: var(--primary); margin-right: 8px;"></i> Appropriate tone and terminology</li>
                        <li><i class="fas fa-check-circle" style="color: var(--primary); margin-right: 8px;"></i> Relevant services to suggest</li>
                        <li><i class="fas fa-check-circle" style="color: var(--primary); margin-right: 8px;"></i> Industry-specific questions</li>
                    </ul>
                </div>
                <p style="font-size: 0.85rem; color: #6b7280; margin-top: 20px; line-height: 1.7;">
                    <strong>Example:</strong> A restaurant AI knows about reservations, menu items, and dietary restrictions.
                </p>
            </div>
        </div>
    </div>

    <div class="section-header" id="ai-brain-section">
        <h2>üß† AI Knowledge Base</h2>
        <div class="section-line"></div>
    </div>

    <div class="grid">
        <div class="tool-card wide-card" id="card-brain">
            <div style="flex: 1.2;">
                <div class="icon-box">üìñ</div>
                <h3>System Prompt & Identity <span class="op-indicator"><span class="pulse-dot"></span> READY</span></h3>
                <p class="tool-description">Define the core personality and operational constraints of your AI agent.</p>
                
                <div class="input-group">
                    <label><i class="fas fa-terminal" style="margin-right: 8px; color: var(--primary);"></i> Global System Instructions</label>
                    <textarea id="aiInstructions" rows="8" placeholder="Example: You are a professional support agent for 'Elite Cars'. Your tone is luxury and helpful..."></textarea>
                </div>
            </div>
            
            <div style="flex: 0.8; background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); padding: 30px; border-radius: 18px;">
                <h3 style="color: #1f2937; margin-bottom: 15px;">‚öôÔ∏è Execution Settings</h3>
                
                <div class="input-group">
                    <label>Creativity (Temperature)</label>
                    <select id="aiTemp">
                        <option value="0.1">Strict & Technical</option>
                        <option value="0.4">Helpful & Direct</option>
                        <option value="0.7" selected>Balanced & Conversational</option>
                        <option value="1.0">Creative & Marketing Focused</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Default Language</label>
                    <select id="aiLang">
                        <option value="auto">Auto-Detect</option>
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                    </select>
                </div>
                
                <button class="btn-save" onclick="saveSmartTool('brain', event)">
                    <i class="fas fa-cloud-upload-alt"></i> Deploy Knowledge Update
                </button>
            </div>
        </div>
    </div>

    <div class="section-header">
        <h2>üöÄ Enterprise Intelligence</h2>
        <div class="section-line"></div>
    </div>

    <div class="grid">
        <!-- Apollo Card -->
        <div class="tool-card locked-card" id="card-apollo">
            <div class="lock-overlay">
                <span>üîí</span>
                <p>Enterprise Feature</p>
                <button class="upgrade-btn" onclick="window.location.href='dashboard.html'">Upgrade to Unlock</button>
            </div>
            <div>
                <div class="icon-box">üîç</div>
                <h3>Apollo Lead Scraper <span class="status-badge badge-enterprise">Enterprise</span></h3>
                <p class="tool-description">Enrich every chat lead with professional data.</p>
                
                <div class="input-group">
                    <label>Apollo API Key</label>
                    <input type="password" id="apolloKey" placeholder="sk_xxxxxxxxxxxxxxxx">
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('apollo', event)">Connect Apollo API</button>
        </div>

        <!-- Follow-up Card -->
        <div class="tool-card locked-card" id="card-followup">
            <div class="lock-overlay">
                <span>üîí</span>
                <p>Pro Feature</p>
                <button class="upgrade-btn" onclick="window.location.href='dashboard.html'">Upgrade to Unlock</button>
            </div>
            <div>
                <div class="icon-box">üìß</div>
                <h3>AI Email Nurture <span class="status-badge badge-pro">Pro</span></h3>
                <p class="tool-description">Automated follow-up emails for leads.</p>
                
                <div class="switch-group">
                    <span>Enable Auto-Nurture</span>
                    <label class="switch">
                        <input type="checkbox" id="followupToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('followup', event)">Activate Automation</button>
        </div>

        <!-- Vision Card -->
        <div class="tool-card locked-card" id="card-vision">
            <div class="lock-overlay">
                <span>üîí</span>
                <p>Enterprise Feature</p>
                <button class="upgrade-btn" onclick="window.location.href='dashboard.html'">Upgrade to Unlock</button>
            </div>
            <div>
                <div class="icon-box">üëÅÔ∏è</div>
                <h3>AI Vision Hub <span class="status-badge badge-enterprise">Enterprise</span></h3>
                <p class="tool-description">Analyze images, PDFs, and documents.</p>
                
                <div class="switch-group">
                    <span>Allow Image Uploads</span>
                    <label class="switch">
                        <input type="checkbox" id="visionToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('vision', event)">Update Vision Settings</button>
        </div>
    </div>

    <div class="section-header">
        <h2>üõ†Ô∏è Operational Tools</h2>
        <div class="section-line"></div>
    </div>

    <div class="grid">
        <!-- Booking Card -->
        <div class="tool-card" id="card-booking">
            <div>
                <div class="icon-box">üìÖ</div>
                <h3>Appointment Logic <span class="op-indicator"><span class="pulse-dot"></span> READY</span></h3>
                <p class="tool-description">Configure booking links and scheduling.</p>
                
                <div class="input-group">
                    <label><i class="fas fa-link" style="margin-right: 8px; color: var(--primary);"></i> Primary Booking Link</label>
                    <input type="text" id="bookingUrl" placeholder="https://calendly.com/your-business/meeting">
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('booking', event)">
                <i class="fas fa-sync-alt"></i> Sync Booking Logic
            </button>
        </div>

        <!-- Sentiment Card -->
        <div class="tool-card locked-card" id="card-sentiment">
            <div class="lock-overlay">
                <span>üîí</span>
                <p>Pro Feature</p>
                <button class="upgrade-btn" onclick="window.location.href='dashboard.html'">Upgrade to Unlock</button>
            </div>
            <div>
                <div class="icon-box">üõ°Ô∏è</div>
                <h3>Crisis Guard <span class="status-badge badge-pro">Pro</span></h3>
                <p class="tool-description">Real-time sentiment alerts.</p>
                
                <div class="input-group">
                    <label>Alert Email</label>
                    <input type="email" id="alertEmail" placeholder="ops@yourcompany.com">
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('sentiment', event)">Save Security Rules</button>
        </div>

        <!-- Webhook Card -->
        <div class="tool-card locked-card" id="card-webhook">
            <div class="lock-overlay">
                <span>üîí</span>
                <p>Pro Feature</p>
                <button class="upgrade-btn" onclick="window.location.href='dashboard.html'">Upgrade to Unlock</button>
            </div>
            <div>
                <div class="icon-box">‚ö°</div>
                <h3>CRM Webhooks <span class="status-badge badge-pro">Pro</span></h3>
                <p class="tool-description">Sync leads with Zapier, HubSpot, etc.</p>
                
                <div class="input-group">
                    <label>Webhook URL</label>
                    <input type="text" id="webhookUrl" placeholder="https://hooks.zapier.com/v1/...">
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('webhook', event)">Save Webhook</button>
        </div>
    </div>

    <div class="section-header" id="org-section">
        <h2>üè¢ Organization & Team</h2>
        <div class="section-line"></div>
    </div>

    <div class="grid">
        <div class="tool-card wide-card">
            <div style="width: 100%;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div>
                        <h3>Staff Permissions <span class="op-indicator"><span class="pulse-dot"></span> READY</span></h3>
                        <p class="tool-description" style="margin-bottom: 0;">Manage team access and roles.</p>
                    </div>
                    <button class="btn-save" style="width: auto; padding: 12px 30px; background: linear-gradient(135deg, #1f2937 0%, #111827 100%);" onclick="openInviteModal()">
                        <i class="fas fa-user-plus"></i> Add Team Member
                    </button>
                </div>

                <div class="data-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teamTableBody">
                            <tr>
                                <td><strong>Current User</strong></td>
                                <td id="userEmail">admin@business.io</td>
                                <td><span class="role-tag tag-admin">Owner</span></td>
                                <td><span style="color: #10b981; font-weight: 600;"><i class="fas fa-circle" style="font-size: 8px; margin-right: 5px;"></i> Online</span></td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="grid" style="margin-top: 30px;">
        <!-- Handover Card -->
        <div class="tool-card" id="card-handover">
            <div>
                <div class="icon-box">üéß</div>
                <h3>Live Handover</h3>
                <p class="tool-description">Define when AI hands off to humans.</p>
                
                <div class="input-group">
                    <label>Trigger Condition</label>
                    <select id="handoverTrigger">
                        <option value="human">Ask for representative</option>
                        <option value="fail">AI fails 3 times</option>
                        <option value="complex">High-value lead detected</option>
                        <option value="manual">Always Manual</option>
                    </select>
                </div>
            </div>
            <button class="btn-save" onclick="saveSmartTool('handover', event)">Set Handover Rules</button>
        </div>

        <!-- Analytics Card -->
        <div class="tool-card" id="card-analytics">
            <div>
                <div class="icon-box">üìà</div>
                <h3>Reporting Hub</h3>
                <p class="tool-description">Export comprehensive business data.</p>
                
                <div style="padding: 20px; background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border-radius: 14px; margin-bottom: 20px;">
                    <p style="font-size: 0.9rem; color: #4b5563; margin-bottom: 10px;">Monthly AI Accuracy: <strong style="color: var(--primary);">98.2%</strong></p>
                    <p style="font-size: 0.9rem; color: #4b5563;">Leads Captured: <strong style="color: var(--primary);">1,402</strong></p>
                </div>
            </div>
            <button class="btn-save" style="background: linear-gradient(135deg, #374151 0%, #1f2937 100%);" onclick="exportBusinessData()">
                <i class="fas fa-download"></i> Download Report
            </button>
        </div>
    </div>
</div>

<footer>
    <p>¬© 2026 AI Smart Business Hub | <span style="color: var(--primary);">Advanced Agent Control Panel</span></p>
</footer>

<!-- Load smart-logic.js -->
<script src="smart-logic.js"></script>

<!-- FIXED: Comprehensive save function for all tool types -->
<script>
// Tool state management
const toolStates = JSON.parse(localStorage.getItem('toolStates') || '{}');

// Get tool name
function getToolName(toolType) {
    const names = {
        'business_type': 'Business Identity',
        'brain': 'AI Knowledge Base',
        'booking': 'Appointment Logic',
        'apollo': 'Apollo Lead Scraper',
        'followup': 'AI Email Nurture',
        'vision': 'AI Vision Hub',
        'sentiment': 'Crisis Guard',
        'handover': 'Live Handover',
        'webhook': 'CRM Webhook'
    };
    return names[toolType] || toolType;
}

// Load tool states
function loadToolStates() {
    const saved = localStorage.getItem('toolStates');
    if (saved) {
        Object.assign(toolStates, JSON.parse(saved));
        Object.keys(toolStates).forEach(toolType => {
            if (toolStates[toolType]) {
                const card = document.getElementById(`card-${toolType === 'business_type' ? 'business-type' : toolType}`);
                if (card) {
                    const btn = card.querySelector('.btn-save');
                    if (btn && !btn.innerHTML.includes('LIVE')) {
                        btn.innerHTML = '‚óè LIVE';
                        btn.classList.add('btn-live-status');
                    }
                }
            }
        });
    }
}

// Save function
window.saveSmartTool = function(toolType, event) {
    const token = localStorage.getItem('token');
    if (!token) {
        alert("Please log in first");
        return;
    }
    
    const btn = event?.currentTarget || event?.target;
    const originalText = btn ? btn.innerHTML : '';
    
    // Check if tool is already LIVE (for deactivation)
    const isLive = toolStates[toolType] === true;
    
    if (isLive) {
        if (confirm(`Are you sure you want to deactivate ${getToolName(toolType)}?`)) {
            deactivateTool(toolType, btn);
        }
        return;
    }
    
    // Activate/save tool
    if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    }
    
    // Collect data
    let data = {};
    switch(toolType) {
        case 'business_type':
            data = {
                business_type: document.getElementById('businessType')?.value || '',
                business_description: document.getElementById('businessDescription')?.value || ''
            };
            break;
        case 'brain':
            data = {
                instructions: document.getElementById('aiInstructions')?.value || '',
                temp: document.getElementById('aiTemp')?.value || '0.7',
                lang: document.getElementById('aiLang')?.value || 'auto'
            };
            break;
        case 'booking':
            data = { url: document.getElementById('bookingUrl')?.value || '' };
            break;
        case 'apollo':
            data = {
                apolloKey: document.getElementById('apolloKey')?.value || '',
                autoSync: document.getElementById('syncToggle')?.checked || false
            };
            break;
        case 'followup':
            data = { enabled: document.getElementById('followupToggle')?.checked || false };
            break;
        case 'vision':
            data = {
                enabled: document.getElementById('visionToggle')?.checked || false,
                sensitivity: document.getElementById('visionSens')?.value || 'high',
                area: document.getElementById('visionArea')?.value || 'all'
            };
            break;
        case 'sentiment':
            data = {
                enabled: document.getElementById('sentimentToggle')?.checked || false,
                email: document.getElementById('alertEmail')?.value || ''
            };
            break;
        case 'handover':
            data = { trigger: document.getElementById('handoverTrigger')?.value || 'human' };
            break;
        case 'webhook':
            data = { url: document.getElementById('webhookUrl')?.value || '' };
            break;
    }
    
    // Send to backend
    fetch(`${window.BACKEND_URL || 'https://ai-smart-hub.onrender.com'}/api/smart-hub/save`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ toolType, data })
    })
    .then(res => {
        if (!res.ok) {
            return res.text().then(text => { throw new Error(text); });
        }
        return res.json();
    })
    .then(result => {
        if (result.success) {
            toolStates[toolType] = true;
            localStorage.setItem('toolStates', JSON.stringify(toolStates));
            
            if (btn) {
                btn.innerHTML = '‚úì Saved';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.innerHTML = '‚óè LIVE';
                    btn.classList.add('btn-live-status');
                    btn.disabled = false;
                }, 1000);
            }
            
            alert(`${getToolName(toolType)} activated successfully!`);
        } else {
            throw new Error(result.error || "Save failed");
        }
    })
    .catch(err => {
        console.error(`[${toolType}] Error:`, err);
        if (btn) {
            btn.innerHTML = '‚ùå Error';
            btn.style.background = '#ef4444';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
                btn.disabled = false;
            }, 2000);
        }
        alert(`Failed: ${err.message}`);
    });
};

// Deactivate tool
window.deactivateTool = function(toolType, btn) {
    const token = localStorage.getItem('token');
    if (!token) {
        alert("Please log in first");
        return;
    }
    
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deactivating...';
    
    fetch(`${window.BACKEND_URL || 'https://ai-smart-hub.onrender.com'}/api/smart-hub/deactivate`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ toolType })
    })
    .then(res => {
        if (!res.ok) {
            return res.text().then(text => { throw new Error(text); });
        }
        return res.json();
    })
    .then(result => {
        if (result.success) {
            toolStates[toolType] = false;
            localStorage.setItem('toolStates', JSON.stringify(toolStates));
            
            btn.innerHTML = '‚úì Deactivated';
            btn.style.background = '#6b7280';
            btn.classList.remove('btn-live-status');
            
            setTimeout(() => {
                btn.innerHTML = 'Activate';
                btn.disabled = false;
                btn.style.background = '';
            }, 1500);
            
            alert(`${getToolName(toolType)} deactivated.`);
        } else {
            throw new Error(result.error || "Deactivation failed");
        }
    })
    .catch(err => {
        console.error(`[${toolType}] Deactivation Error:`, err);
        alert(`Failed: ${err.message}`);
        btn.innerHTML = originalText;
        btn.disabled = false;
    });
};

// Team invite
window.openInviteModal = function() {
    const email = prompt("Enter team member email:");
    if (email && email.includes('@')) {
        const table = document.getElementById('teamTableBody');
        if(!table) return;
        const newRow = table.insertRow();
        newRow.innerHTML = `
            <td><strong>New Member</strong></td>
            <td>${email}</td>
            <td><span class="role-tag tag-staff">Staff</span></td>
            <td><span style="color: #f59e0b;"><i class="fas fa-circle" style="font-size: 8px;"></i> Pending</span></td>
            <td><button onclick="this.parentElement.parentElement.remove()" style="background:none; border:none; color:#ef4444; cursor:pointer;"><i class="fas fa-trash"></i></button></td>
        `;
        alert("Invitation sent to " + email);
    }
};

// Export data
window.exportBusinessData = function() {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
    btn.disabled = true;
    
    setTimeout(() => {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(localStorage, null, 2));
        const a = document.createElement('a');
        a.href = dataStr;
        a.download = "business_export.json";
        a.click();
        btn.innerHTML = originalText;
        btn.disabled = false;
    }, 1000);
};

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
    loadToolStates();
    
    const token = localStorage.getItem('token');
    if (token) {
        try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            const emailEl = document.getElementById('userEmail');
            if (emailEl) emailEl.textContent = payload.email || 'admin@business.io';
        } catch (e) {}
    }
});
</script>

</body>
</html>